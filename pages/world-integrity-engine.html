<!doctype html>
<html lang="en" class="">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>The World Integrity Engine: An AI-Based System for Evaluating Plot Consistency, Continuity Accuracy, Canon Adherence, and Worldbuilding Integrity.</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    
:root {
  --background: 165 50% 97%;
  --foreground: 180 4% 5%;
  --muted: 180 5% 96%;
  --muted-foreground: 170 3% 40%;
  --popover: 0 0% 99%;
  --popover-foreground: 180 4% 5%;
  --card: 0 0% 99%;
  --card-foreground: 180 4% 5%;
  --primary: 173 80% 36%;
  --primary-foreground: 210 40% 98%;
  --secondary: 171 16% 92%;
  --secondary-foreground: 222.2 47.4% 11.2%;
  --accent: 171 16% 92%;
  --accent-foreground: 222.2 47.4% 11.2%;
  --destructive: 10 78% 54%;
  --destructive-foreground: 0 0% 98%;
  --border: 214.3 31.8% 91.4%;
  --input: 214.3 31.8% 86.4%;
  --link: 172 100% 26%;
  --ring: 173 46% 72%;
  --radius: 0.5rem;
}
.dark {
  --background: 165 11% 7%;
  --foreground: 171 14% 90%;
  --muted: 175 18% 14%;
  --muted-foreground: 173 8% 60%;
  --accent: 174 55% 11%;
  --accent-foreground: 174 55% 98%;
  --popover: 180 9% 9%;
  --popover-foreground: 171 14% 90%;
  --card: 180 9% 9%;
  --card-foreground: 171 14% 90%;
  --primary: 173 80% 36%;
  --primary-foreground: 210 40% 98%;
  --secondary: 174 55% 11%;
  --secondary-foreground: 163 69% 98%;
  --destructive: 10 78% 40%;
  --destructive-foreground: 210 40% 98%;
  --border: 173 10% 17%;
  --input: 175 10% 25%;
  --ring: 173 50% 45%;
  --link: 170 90% 45%;
}

    
/* Semantic token classes for this standalone page (matches your Tailwind CSS variables) */
.bg-background{background-color:hsl(var(--background));}
.text-foreground{color:hsl(var(--foreground));}
.bg-card{background-color:hsl(var(--card));}
.text-card-foreground{color:hsl(var(--card-foreground));}
.bg-muted{background-color:hsl(var(--muted));}
.text-muted-foreground{color:hsl(var(--muted-foreground));}
.bg-popover{background-color:hsl(var(--popover));}
.border-border{border-color:hsl(var(--border));}
.ring-ring{--tw-ring-color:hsl(var(--ring));}
.text-primary{color:hsl(var(--primary));}
.bg-primary{background-color:hsl(var(--primary));}
.text-primary-foreground{color:hsl(var(--primary-foreground));}
.bg-accent{background-color:hsl(var(--accent));}
.text-link{color:hsl(var(--link));}

    html{scroll-behavior:smooth;}
    ::selection{background-color:hsl(var(--primary));color:hsl(var(--primary-foreground));}
  </style>
</head>
<body class="bg-background text-foreground">
  <!-- Top bar -->
  <header class="sticky top-0 z-40 border-b border-border/70 bg-background/80 backdrop-blur">
    <div class="mx-auto flex max-w-7xl items-center justify-between px-4 py-3">
      <div class="min-w-0">
        <p class="text-xs text-muted-foreground">Document</p>
        <h1 class="truncate text-sm font-semibold tracking-tight">The World Integrity Engine: An AI-Based System for Evaluating Plot Consistency, Continuity Accuracy, Canon Adherence, and Worldbuilding Integrity.</h1>
      </div>
      <div class="flex items-center gap-2">
        <button id="themeBtn" class="rounded-xl border border-border/70 bg-card px-3 py-2 text-xs font-medium text-muted-foreground hover:bg-muted/50">
          Toggle theme
        </button>
        <a href="#content" class="rounded-xl bg-primary px-3 py-2 text-xs font-medium text-primary-foreground hover:opacity-95">
          Jump to content
        </a>
      </div>
    </div>
  </header>

  <!-- Layout -->
  <div class="mx-auto grid max-w-7xl grid-cols-1 gap-6 px-4 py-6 lg:grid-cols-[320px_1fr]">
    <!-- Sidebar / TOC -->
    <aside class="hidden lg:block">
      <div class="sticky top-20 rounded-2xl border border-border/70 bg-card p-4 shadow-sm">
        <div class="flex items-start justify-between gap-2">
          <div>
            <p class="text-xs font-medium text-muted-foreground">On this page</p>
            <p class="mt-1 text-sm font-semibold tracking-tight">Table of contents</p>
          </div>
        </div>
        <div class="mt-3 max-h-[75vh] overflow-auto pr-2">
          <ul class="ml-3 mt-2 space-y-1">
<li><a class="block rounded-lg px-2 py-1 text-sm text-muted-foreground hover:bg-muted/60 hover:text-foreground" href="#acknowledgements">Acknowledgements</a></li>
<li><a class="block rounded-lg px-2 py-1 text-sm text-muted-foreground hover:bg-muted/60 hover:text-foreground" href="#abstract">ABSTRACT</a></li>
<li><a class="block rounded-lg px-2 py-1 text-sm text-muted-foreground hover:bg-muted/60 hover:text-foreground" href="#chapter-1-introduction">Chapter 1: INTRODUCTION</a></li>
<ul class="ml-3 mt-2 space-y-1">
<li><a class="block rounded-lg px-2 py-1 text-sm text-muted-foreground hover:bg-muted/60 hover:text-foreground" href="#aims-and-objectives">AIMS AND OBJECTIVES</a></li>
<ul class="ml-3 mt-2 space-y-1">
<li><a class="block rounded-lg px-2 py-1 text-sm text-muted-foreground hover:bg-muted/60 hover:text-foreground" href="#aim">Aim:</a></li>
<li><a class="block rounded-lg px-2 py-1 text-sm text-muted-foreground hover:bg-muted/60 hover:text-foreground" href="#objectives">Objectives:</a></li>
</ul>
</ul>
<li><a class="block rounded-lg px-2 py-1 text-sm text-muted-foreground hover:bg-muted/60 hover:text-foreground" href="#chapter-2-literature-review">Chapter 2: LITERATURE REVIEW</a></li>
<li><a class="block rounded-lg px-2 py-1 text-sm text-muted-foreground hover:bg-muted/60 hover:text-foreground" href="#chapter-3-research-methodologies-and-tools">Chapter 3: RESEARCH METHODOLOGIES AND TOOLS</a></li>
<ul class="ml-3 mt-2 space-y-1">
<li><a class="block rounded-lg px-2 py-1 text-sm text-muted-foreground hover:bg-muted/60 hover:text-foreground" href="#research-design">Research Design</a></li>
<ul class="ml-3 mt-2 space-y-1">
<li><a class="block rounded-lg px-2 py-1 text-sm text-muted-foreground hover:bg-muted/60 hover:text-foreground" href="#synthetic-truth-logic-consistency-score-stlcs">Synthetic Truth Logic Consistency Score (STLCS)</a></li>
<li><a class="block rounded-lg px-2 py-1 text-sm text-muted-foreground hover:bg-muted/60 hover:text-foreground" href="#continuity-accuracy-metric-cam">Continuity Accuracy Metric (CAM)</a></li>
<li><a class="block rounded-lg px-2 py-1 text-sm text-muted-foreground hover:bg-muted/60 hover:text-foreground" href="#canon-adherence-score-cas">Canon Adherence Score (CAS)</a></li>
<li><a class="block rounded-lg px-2 py-1 text-sm text-muted-foreground hover:bg-muted/60 hover:text-foreground" href="#world-integrity-score-wis">World Integrity Score (WIS)</a></li>
<li><a class="block rounded-lg px-2 py-1 text-sm text-muted-foreground hover:bg-muted/60 hover:text-foreground" href="#objective-1-plot-consistency-stlcs">OBJECTIVE 1: PLOT CONSISTENCY (STLCS)</a></li>
<li><a class="block rounded-lg px-2 py-1 text-sm text-muted-foreground hover:bg-muted/60 hover:text-foreground" href="#objective-2-canon-adherence">OBJECTIVE 2: CANON ADHERENCE</a></li>
<li><a class="block rounded-lg px-2 py-1 text-sm text-muted-foreground hover:bg-muted/60 hover:text-foreground" href="#objective-3-continuity-accuracy">OBJECTIVE 3: CONTINUITY ACCURACY</a></li>
<li><a class="block rounded-lg px-2 py-1 text-sm text-muted-foreground hover:bg-muted/60 hover:text-foreground" href="#objective-4-world-building-integrity">OBJECTIVE 4: WORLD BUILDING INTEGRITY</a></li>
<li><a class="block rounded-lg px-2 py-1 text-sm text-muted-foreground hover:bg-muted/60 hover:text-foreground" href="#summary">SUMMARY</a></li>
</ul>
</ul>
<li><a class="block rounded-lg px-2 py-1 text-sm text-muted-foreground hover:bg-muted/60 hover:text-foreground" href="#chapter-4-design-and-development">Chapter 4: Design and Development</a></li>
<ul class="ml-3 mt-2 space-y-1">
<li><a class="block rounded-lg px-2 py-1 text-sm text-muted-foreground hover:bg-muted/60 hover:text-foreground" href="#introduction">Introduction</a></li>
<li><a class="block rounded-lg px-2 py-1 text-sm text-muted-foreground hover:bg-muted/60 hover:text-foreground" href="#results-presentation">Results Presentation</a></li>
<ul class="ml-3 mt-2 space-y-1">
<li><a class="block rounded-lg px-2 py-1 text-sm text-muted-foreground hover:bg-muted/60 hover:text-foreground" href="#component-structure">Component Structure</a></li>
<li><a class="block rounded-lg px-2 py-1 text-sm text-muted-foreground hover:bg-muted/60 hover:text-foreground" href="#key-features">Key Features</a></li>
</ul>
<li><a class="block rounded-lg px-2 py-1 text-sm text-muted-foreground hover:bg-muted/60 hover:text-foreground" href="#objective-1-plot-consistency">Objective 1: PLOT CONSISTENCY</a></li>
<li><a class="block rounded-lg px-2 py-1 text-sm text-muted-foreground hover:bg-muted/60 hover:text-foreground" href="#objective-2-canon-adherance">Objective 2: CANON ADHERANCE</a></li>
<li><a class="block rounded-lg px-2 py-1 text-sm text-muted-foreground hover:bg-muted/60 hover:text-foreground" href="#objective-3-continuity-accuracy-2">Objective 3: CONTINUITY ACCURACY</a></li>
<li><a class="block rounded-lg px-2 py-1 text-sm text-muted-foreground hover:bg-muted/60 hover:text-foreground" href="#objective-4-world-building-integrity-2">Objective 4: WORLD BUILDING INTEGRITY</a></li>
<li><a class="block rounded-lg px-2 py-1 text-sm text-muted-foreground hover:bg-muted/60 hover:text-foreground" href="#summary-2">SUMMARY</a></li>
</ul>
<li><a class="block rounded-lg px-2 py-1 text-sm text-muted-foreground hover:bg-muted/60 hover:text-foreground" href="#chapter-5-implementation-and-testing">Chapter 5: Implementation and Testing</a></li>
<ul class="ml-3 mt-2 space-y-1">
<li><a class="block rounded-lg px-2 py-1 text-sm text-muted-foreground hover:bg-muted/60 hover:text-foreground" href="#testing-strategy">Testing Strategy</a></li>
<ul class="ml-3 mt-2 space-y-1">
<li><a class="block rounded-lg px-2 py-1 text-sm text-muted-foreground hover:bg-muted/60 hover:text-foreground" href="#unit-testing">Unit Testing</a></li>
<li><a class="block rounded-lg px-2 py-1 text-sm text-muted-foreground hover:bg-muted/60 hover:text-foreground" href="#system-integration-testing">System Integration Testing</a></li>
<ul class="ml-3 mt-2 space-y-1">
<li><a class="block rounded-lg px-2 py-1 text-sm text-muted-foreground hover:bg-muted/60 hover:text-foreground" href="#key-checks-performed">Key checks performed:</a></li>
</ul>
<li><a class="block rounded-lg px-2 py-1 text-sm text-muted-foreground hover:bg-muted/60 hover:text-foreground" href="#simulation-testing-with-short-stories">Simulation Testing with Short Stories</a></li>
</ul>
<li><a class="block rounded-lg px-2 py-1 text-sm text-muted-foreground hover:bg-muted/60 hover:text-foreground" href="#results-presentation-2">Results Presentation</a></li>
<li><a class="block rounded-lg px-2 py-1 text-sm text-muted-foreground hover:bg-muted/60 hover:text-foreground" href="#story-1">Story 1:</a></li>
<li><a class="block rounded-lg px-2 py-1 text-sm text-muted-foreground hover:bg-muted/60 hover:text-foreground" href="#story-2">Story 2:</a></li>
</ul>
<li><a class="block rounded-lg px-2 py-1 text-sm text-muted-foreground hover:bg-muted/60 hover:text-foreground" href="#chapter-6-discussion-and-critical-appraisal-of-result">Chapter 6: Discussion and Critical Appraisal of Result</a></li>
<ul class="ml-3 mt-2 space-y-1">
<li><a class="block rounded-lg px-2 py-1 text-sm text-muted-foreground hover:bg-muted/60 hover:text-foreground" href="#objective-1-plot-consistency-stlcs-2">Objective 1 — Plot Consistency (STLCS)</a></li>
<li><a class="block rounded-lg px-2 py-1 text-sm text-muted-foreground hover:bg-muted/60 hover:text-foreground" href="#objective-2-canon-adherence-2">Objective 2 — Canon Adherence</a></li>
<li><a class="block rounded-lg px-2 py-1 text-sm text-muted-foreground hover:bg-muted/60 hover:text-foreground" href="#objective-3-continuity-accuracy-3">Objective 3 — Continuity Accuracy</a></li>
<li><a class="block rounded-lg px-2 py-1 text-sm text-muted-foreground hover:bg-muted/60 hover:text-foreground" href="#objective-4-worldbuilding-integrity-wis">Objective 4 — Worldbuilding Integrity (WIS)</a></li>
<li><a class="block rounded-lg px-2 py-1 text-sm text-muted-foreground hover:bg-muted/60 hover:text-foreground" href="#comparison-to-previous-studies">Comparison to Previous Studies.</a></li>
<li><a class="block rounded-lg px-2 py-1 text-sm text-muted-foreground hover:bg-muted/60 hover:text-foreground" href="#contributions-and-novelty">Contributions and Novelty</a></li>
<ul class="ml-3 mt-2 space-y-1">
<li><a class="block rounded-lg px-2 py-1 text-sm text-muted-foreground hover:bg-muted/60 hover:text-foreground" href="#key-contributions">Key Contributions</a></li>
<ul class="ml-3 mt-2 space-y-1">
<li><a class="block rounded-lg px-2 py-1 text-sm text-muted-foreground hover:bg-muted/60 hover:text-foreground" href="#formalisation-of-narrative-integrity-into-four-dimensions">Formalisation of Narrative Integrity into Four Dimensions</a></li>
<li><a class="block rounded-lg px-2 py-1 text-sm text-muted-foreground hover:bg-muted/60 hover:text-foreground" href="#novel-computational-metrics-for-world-integrity-evaluation">Novel Computational Metrics for World Integrity Evaluation</a></li>
<li><a class="block rounded-lg px-2 py-1 text-sm text-muted-foreground hover:bg-muted/60 hover:text-foreground" href="#reader-simulation-paradigm-using-llms-and-embeddings">Reader-Simulation Paradigm Using LLMs and Embeddings</a></li>
<li><a class="block rounded-lg px-2 py-1 text-sm text-muted-foreground hover:bg-muted/60 hover:text-foreground" href="#persistent-world-knowledge-mesh-architecture">Persistent World Knowledge Mesh Architecture</a></li>
<li><a class="block rounded-lg px-2 py-1 text-sm text-muted-foreground hover:bg-muted/60 hover:text-foreground" href="#interactive-evaluation-interface-for-authors">Interactive Evaluation Interface for Authors</a></li>
</ul>
<li><a class="block rounded-lg px-2 py-1 text-sm text-muted-foreground hover:bg-muted/60 hover:text-foreground" href="#further-work">Further Work</a></li>
<li><a class="block rounded-lg px-2 py-1 text-sm text-muted-foreground hover:bg-muted/60 hover:text-foreground" href="#critical-appraisal">Critical Appraisal</a></li>
</ul>
</ul>
<li><a class="block rounded-lg px-2 py-1 text-sm text-muted-foreground hover:bg-muted/60 hover:text-foreground" href="#chapter-7-conclusion">Chapter 7: Conclusion</a></li>
<li><a class="block rounded-lg px-2 py-1 text-sm text-muted-foreground hover:bg-muted/60 hover:text-foreground" href="#chapter-8-ethics-approval">Chapter 8: ETHICS APPROVAL</a></li>
<li><a class="block rounded-lg px-2 py-1 text-sm text-muted-foreground hover:bg-muted/60 hover:text-foreground" href="#chapter-9-references">Chapter 9: REFERENCES</a></li>
<li><a class="block rounded-lg px-2 py-1 text-sm text-muted-foreground hover:bg-muted/60 hover:text-foreground" href="#appendices">Appendices</a></li>
<ul class="ml-3 mt-2 space-y-1">
<li><a class="block rounded-lg px-2 py-1 text-sm text-muted-foreground hover:bg-muted/60 hover:text-foreground" href="#evaluatorpy">Evaluator.py</a></li>
<li><a class="block rounded-lg px-2 py-1 text-sm text-muted-foreground hover:bg-muted/60 hover:text-foreground" href="#loreenginepy">Lore_engine.py</a></li>
</ul>
</ul>
        </div>
      </div>
    </aside>

    <!-- Main content -->
    <main id="content" class="min-w-0">
      <!-- Hero -->
      <section class="rounded-2xl border border-border/70 bg-card p-6 shadow-sm">
        <div class="flex flex-col gap-3">
          <div class="inline-flex items-center gap-2">
            <span class="h-2.5 w-2.5 rounded-full bg-primary"></span>
            <span class="text-xs font-medium text-muted-foreground">Converted from DOCX</span>
          </div>
          <h2 class="text-2xl font-semibold tracking-tight">The World Integrity Engine: An AI-Based System for Evaluating Plot Consistency, Continuity Accuracy, Canon Adherence, and Worldbuilding Integrity.</h2>
          <p class="text-sm text-muted-foreground">SID: 2355846</p>
          <div class="mt-2 rounded-2xl bg-muted/40 p-4 ring-1 ring-border/60">
            <p class="text-sm text-muted-foreground">
              This page is hard-coded from your Word document and styled using your token-based theme (HSL CSS variables).
              It supports light/dark via the <span class="text-primary font-medium">Toggle theme</span> button.
            </p>
          </div>
        </div>
      </section>

      <!-- Body -->
      <article class="mt-6 rounded-2xl border border-border/70 bg-card p-6 shadow-sm">
        <h1 id="acknowledgements" class="mt-10 scroll-mt-24 font-semibold tracking-tight text-foreground text-2xl">Acknowledgements</h1>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">All the praise goes to my Lord God, for the opportunity to pursue my Masters with determination, faith and strength.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">I would like to sincerely thank my supervisor, Dr. Ronak, for her unwavering support, patience, encouragement, and goodwill throughout the course of my research. Her invaluable guidance and consistent support during the research process are deeply appreciated. I am also grateful to Dr. Cristina Luca, Course Leader for MSc Computer Science, for her assistance as my Academic Personal Tutor and for always being approachable and willing to offer help whenever needed.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">My heartfelt gratitude also goes to my mum, dad, brother, and sisters. Despite the distance between us, you have remained my strongest supporters and a constant source of positive energy, inspiration, perseverance, and resilience in times of difficulty. Thank you for your love and prayers, which have protected and sustained me more than you can imagine, and have helped me reach this milestone.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">List of Figures</p>
<ul class="mt-3 list-disc pl-6"><li class="mt-1 text-sm text-muted-foreground leading-relaxed">Figure 0-1: Author struggling to keep the world they build — p. 8</li><li class="mt-1 text-sm text-muted-foreground leading-relaxed">Figure 0-2: Augmented author focused on story progression as AI keeps the world stable. — p. 8</li><li class="mt-1 text-sm text-muted-foreground leading-relaxed">Figure 3-1: Manual Canon Curation — p. 17</li><li class="mt-1 text-sm text-muted-foreground leading-relaxed">Figure 3-2: Automated Canon Curation — p. 18</li><li class="mt-1 text-sm text-muted-foreground leading-relaxed">Figure 3-3: Canon Adherence Through LLM — p. 19</li><li class="mt-1 text-sm text-muted-foreground leading-relaxed">Figure 3-4: Reader&#x27;s Mental Process — p. 20</li><li class="mt-1 text-sm text-muted-foreground leading-relaxed">Figure 3-5: World Engine Simulation of Reader&#x27;s Mental Process — p. 21</li><li class="mt-1 text-sm text-muted-foreground leading-relaxed">Figure 4-1: Story upload and Processing Sequence — p. 24</li><li class="mt-1 text-sm text-muted-foreground leading-relaxed">Figure 4-2: API Request Processing Sequence — p. 24</li><li class="mt-1 text-sm text-muted-foreground leading-relaxed">Figure 4-3: Plot Consistency Implementation Analogy — p. 28</li><li class="mt-1 text-sm text-muted-foreground leading-relaxed">Figure 4-4: A summary of Plot Consistency Implementation — p. 30</li><li class="mt-1 text-sm text-muted-foreground leading-relaxed">Figure 4-5: A summary of Canon Adherence Implementation — p. 32</li><li class="mt-1 text-sm text-muted-foreground leading-relaxed">Figure 4-6: A summary of Continuity Accuracy Implementation — p. 34</li><li class="mt-1 text-sm text-muted-foreground leading-relaxed">Figure 4-7: Logical Flow of events while checking for World Rule Violations — p. 36</li><li class="mt-1 text-sm text-muted-foreground leading-relaxed">Figure 4-8: A summary of World Building Integrity Implementation — p. 37</li><li class="mt-1 text-sm text-muted-foreground leading-relaxed">Figure 4-9: A Concise Summary of All Objective Implementation — p. 38</li><li class="mt-1 text-sm text-muted-foreground leading-relaxed">Figure 5-1: Plot Consistency analysis sample on the Wizard of Oz — p. 42</li><li class="mt-1 text-sm text-muted-foreground leading-relaxed">Figure 5-2: A Sample Canon Synthetic Truth Extract from The Strange Case of Dr. Jekyll and Mr. Hyde — p. 44</li><li class="mt-1 text-sm text-muted-foreground leading-relaxed">Figure 8-1: Research and Professional Ethics Certification of Completion — p. 51</li></ul>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">List of Tables</p>
<ul class="mt-3 list-disc pl-6"><li class="mt-1 text-sm text-muted-foreground leading-relaxed">Table 1: A summary of Methodology for each Objective — p. 22</li><li class="mt-1 text-sm text-muted-foreground leading-relaxed">Table 2: Unit Testing on Key Functions — p. 38</li><li class="mt-1 text-sm text-muted-foreground leading-relaxed">Table 3: A Sample of Canon extracts from The Strange Case of Dr. Jekyll and Mr. Hyde — p. 42</li></ul>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">List of Algorithms</p>
<ul class="mt-3 list-disc pl-6"><li class="mt-1 text-sm text-muted-foreground leading-relaxed">Equation 1: Synthetic Truth Logical Consistency Score (STLCS) — p. 17</li><li class="mt-1 text-sm text-muted-foreground leading-relaxed">Equation 2: Continuity Accuracy Metric (CAM) — p. 17</li><li class="mt-1 text-sm text-muted-foreground leading-relaxed">Equation 3:Canon Adherence Score (CAS) — p. 18</li><li class="mt-1 text-sm text-muted-foreground leading-relaxed">Equation 4: 3.1.4 — p. World Integrity Score (WIS) — p. 18</li><li class="mt-1 text-sm text-muted-foreground leading-relaxed">Equation 5: Collapsible Conflict Segment — p. 28</li><li class="mt-1 text-sm text-muted-foreground leading-relaxed">Equation 6: Pagination of Violations — p. 28</li><li class="mt-1 text-sm text-muted-foreground leading-relaxed">Equation 7: WIS — p. 48</li></ul>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">List of Appendixes</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Evaluator.py</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Lore_engine.py</p>
<h1 id="abstract" class="mt-10 scroll-mt-24 font-semibold tracking-tight text-foreground text-2xl">ABSTRACT</h1>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">This paper proposes a web-based application with Artificial Intelligence (A.I) features designed to manage the Synthetic Truth (S.T) of fictional worlds in which stories are told. ‘Synthetic Truth’ refers to Statements that are True only within the confines of an imagined reality.’</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">The application functions to manage physical, chemical and biological S.T logic, plot consistency, continuity accuracy, canon adherence and worldbuilding integrity.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Plot consistency: When a character establishes a fact, said fact shall not be disputed without a causal link.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Example: In Chapter 4, the protagonist says, “My oxygen tank was ruptured –I only had 60 seconds left to live.” A few pages later, without any explanation, “they wander Mars’ surface for 20 minutes having a conversation.”</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">This breaks plot consistency, as the immediate danger established by the oxygen limit is ignored without any causal link (e.g., finding a spare tank, or switching to a suit with a backup system).</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Worldbuilding Integrity: When an imagined world has a set of principles governing it, said principle should be maintained across the story.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Example: In a fictional world where magic is powered exclusively by sunlight, a character casts a powerful spell during the night in an underground cave with no access to sunlight.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">This breaks worldbuilding integrity, because the story has already established that sunlight is the sole source of magical power. For this moment to remain consistent within the Synthetic Truth of the world, either the principle must be updated with a causal explanation (e.g., the character stores sunlight in crystals or specialized sunlight organs for later use), or the spellcasting must be altered to occur under valid conditions.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Continuity accuracy: Details are to remain logically consistent throughout a story&#x27;s timeline, such as character injuries, clothing, weather, or object locations.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Example: In Chapter 6, a character loses their left eye in a battle and receives a distinctive silver eyepatch.
In Chapter 9, set just two days later, they are described as having both eyes intact and no mention of the eyepatch is made, despite it being a key character feature.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">This is a continuity error, because there is no narrative explanation (e.g., regeneration, illusion magic, or memory tampering) provided to reconcile the change with the previous state.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Canon adherence: Consistent respect of established facts that synthetic truth.
Example: In chapter 1 of a manuscript, it is clearly established that the alien species Zarans are blind and rely on echolocation to navigate. This is emphasized multiple times, including a key scene where a Zaran says, “We do not see as you do. Sound is our sight.”</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">In Chapter 3, a Zaran pilot looks through a telescope and says, “I can see the Earth’s surface from here. It’s beautiful.”
No explanation is given, and the story proceeds as if Zarans have always had visual sight.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Through Object-Oriented software development combined with Top-Down designing for planning and system-centered evaluation testing (quantitative + qualitative error analysis), this study will create an application capable of identifying and keeping track of said objectives.</p>
<div class="mt-4 overflow-x-auto rounded-2xl border border-border/70 bg-card">
  <table class="min-w-full border-separate border-spacing-0">
    <thead class="bg-muted/50">
      <tr><th class="whitespace-nowrap px-3 py-2 text-left text-xs font-semibold text-foreground"></th><th class="whitespace-nowrap px-3 py-2 text-left text-xs font-semibold text-foreground"></th></tr>
    </thead>
    <tbody><tr class="border-t border-border/70"><td class="px-3 py-2 align-top text-sm text-muted-foreground">Figure 0-1: Author struggling to keep the world they build
from imploding.</td><td class="px-3 py-2 align-top text-sm text-muted-foreground">Figure 0-2: Augmented author focused on story progression as AI keeps the world stable.</td></tr></tbody>
  </table>
</div>
<h1 id="chapter-1-introduction" class="mt-10 scroll-mt-24 font-semibold tracking-tight text-foreground text-2xl">Chapter 1: INTRODUCTION</h1>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Storytelling has long been one of the most powerful tools through which humans may express themselves. They shape culture, preserve history, put complex knowledge into perspective, inspire innovation and provide entertainment across generations.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Fictional narratives – In whatever form they are presented in; novels, games, or multimedia franchises –  are increasingly vast and complex, often spanning multiple timelines, character arcs, and interconnected worlds. While these elaborate constructions offer unparalleled richness, they also present a significant challenge: maintaining logical and structural consistency within the narrative. Readers engage with stories by immersing themselves in their internal logic, and any violation of that logic can disrupt immersion, weaken suspension of disbelief, and erode confidence in the author’s craft or attract criticism from dedicated fans towards the institutions developing a story.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">The problem of narrative inconsistency is particularly acute in long-form, collaborative storytelling and in the works of many novice authors. Issues such as contradictory plot developments, misaligned timelines, characters acting in ways that defy previously established canon and forgotten continuity states such as objects declared destroyed in one scene appearing in another or a character’s past accidentally misremembered are common even in widely celebrated works.  For instance, the later seasons of  were heavily criticized for narrative contradictions, and the  franchise required a canon reset to manage inconsistencies across its extended universe.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">These examples illustrate that even professional authors and studios struggle to sustain stability in fiction across sprawling fictional worlds that expand faster than the creators can track them. Especially so in institutionalized settings where writers’ room grow and staff rotation fragments institutional memory. This leads to creators often at times relying on ‘Canon bibles’, style guides or fan wikis and archivists to keep track of their own fiction.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Breaks in a fiction’s stability harm the bottom line of any studio or institution responsible since immersion loss damages the audience’s trust and emotional investment which is expressed in reduced engagement, criticism and bad reviews hence harming the merchandise market and licensing revenue.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">In summary, fictional worlds are delicate ecosystems; they grow fast, get chaotic and become too complex for manual tracking. The theoretical foundation for addressing this challenge lies in Narratology, Possible Worlds theory and Large Language Models. Structural narratology breaks narratives into analyzable units –such as plot, character, and timeline – that can be systematically studied for coherence. Cognitive narratology extends this analysis to the reception of narratives, emphasizing that readers actively construct mental models of fictional worlds while processing stories. Within Possible Worlds theory, fictional universes are treated as logically self-contained systems, where propositions can be evaluated for internal truthfulness. From this perspective, inconsistencies represent violations of the world’s Synthetic Truth, the “reality” that holds within its fictional boundaries.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Despite the theoretical sophistication of narratology and related fields, authors today rely largely on manual tools to maintain consistency: personal notes, spreadsheets, wikis, or even fan-driven knowledge bases. These approaches, while valuable, are prone to human error and become increasingly inadequate as narratives grow in scale and fact-checking and world-coherency reviews are ignored in favor of meeting deadlines.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Existing computational aids for writers have primarily been generative –language models that suggest text or dialogue – rather than evaluative, that is, capable of detecting contradictions, canon breaks, or logical gaps on demand. This gap highlights an opportunity for artificial intelligence to provide substantive support in narrative evaluation.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Recent advances in Natural Language Processing (NLP) and Large Language Models (LLMs) make this possibility increasingly feasible. Embedding models allow machines to capture semantic relationships across narrative elements, while LLMs approximate human reasoning about coherence and contradiction. In effect, AI can be leveraged to verify a fiction world’s logical integrity instead of story generation. This firmly reframes the research frontier, moving from content generation towards computational validation of world integrity.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">This thesis proposes a narrative integrity evaluation software – World Integrity Engine–, a system designed to assist authors (professionals, novices and indie authors) and studios in identifying breaks and inconsistencies in their works without intruding on their creative process. The framework evaluates narratives across four defined objectives: plot consistency, ensuring that causal and temporal links remain coherent; continuity accuracy, validating that timelines, events, and character states progress logically; canon adherence, checking that established rules and lore are not violated; and worldbuilding integrity, assessing whether implied and explicit world structures interact coherently.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">The contribution of this work lies in demonstrating that AI methods can operationalize these objectives, offering authors and studios a tool that reduces cognitive burden while enhancing narrative quality even for novice authors. In doing so, the research bridges Narratological theory, Cognitive science, and computational techniques, showing that artificial intelligence can extend beyond generation into the uncharted grounds of fiction-world verification.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">The remainder of this dissertation is structured as follows. Chapter 3 reviews the existing literature in Narratology, Cognitive Science, and AI-based narrative analysis. Chapter 4 details the methodology and system design of the evaluation engine. Chapter 5 presents the implementation and testing of the system using selected short stories. Chapter 6 discusses the findings, their implications, and limitations. Finally, Chapter 7 concludes with reflections on contributions and recommendations for future research.</p>
<h2 id="aims-and-objectives" class="mt-9 scroll-mt-24 font-semibold tracking-tight text-foreground text-xl">AIMS AND OBJECTIVES</h2>
<h3 id="aim" class="mt-7 scroll-mt-24 font-semibold tracking-tight text-foreground text-lg">Aim:</h3>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">To design, develop, test and deploy a web-based application system with AI tools specifically designed to detect, highlight and quantify the integrity of a fictional world.</p>
<h3 id="objectives" class="mt-7 scroll-mt-24 font-semibold tracking-tight text-foreground text-lg">Objectives:</h3>
<ul class="mt-3 list-disc pl-6"><li class="mt-1 text-sm text-muted-foreground leading-relaxed">Define the term ‘Synthetic Truth’ and its role in bridging implementation of the proposed Author-Machine dynamic.</li><li class="mt-1 text-sm text-muted-foreground leading-relaxed">Build a web application that keeps track of</li><li class="mt-1 text-sm text-muted-foreground leading-relaxed">Plot consistency</li><li class="mt-1 text-sm text-muted-foreground leading-relaxed">Continuity Accuracy</li><li class="mt-1 text-sm text-muted-foreground leading-relaxed">Canon Adherence</li><li class="mt-1 text-sm text-muted-foreground leading-relaxed">Worldbuilding Integrity</li><li class="mt-1 text-sm text-muted-foreground leading-relaxed">Introduce and Implement sets of metrics such as Synthetic Truth Logic Consistency Score (STLCS), Continuity Accuracy Metric (CAM), Canon Fidelity Index, and World Integrity Score (WIS).</li><li class="mt-1 text-sm text-muted-foreground leading-relaxed">Test the System with freely available stories from indie publishing websites, freely available stories from novice authors and freely available stories from professional authors.</li></ul>
<h1 id="chapter-2-literature-review" class="mt-10 scroll-mt-24 font-semibold tracking-tight text-foreground text-2xl">Chapter 2: LITERATURE REVIEW</h1>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">The challenges plaguing narrative coherence within the ever-expanding fictional universes have been documented across Narratology, media studies, and production research.  explores how the audience constructs “storyworlds” from given narrative cues. A ‘storyworld’ being a mental model whereby maintaining internal consistency and coherence are critical since they allow the audiences’ mental models to remain stable and immersive. In this way, it can be seen that stories aren’t simply sequences of events but are instead, rule-based simulations with cause-effect logic and ontological coherence.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">in what the researcher called ‘Transmedia Storytelling’ addressed how narratives are being told across different media. A book, turning into a comic which is then made into a film or animation then also made into a game. Though it increases engagement from the audience, it also creates major coordination challenges since no single media contains the entire story. Instead, each media contributes disparate portions of the narrative and audiences assemble the aggregates into a wider world. Different creative teams, production cycles and corporate structures have to harmonize and maintain a shared canon.  warns that the audience’s active participation invites more scrutinization and without rigorous oversight, contradictions, continuity gaps and lore fragmentation will result in hash backlashes from the audience that often at times police story development more strictly than studios.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">goes further and highlights the complexities in fiction world building and how they are sustained by creating a distinction between the story ( Sequence of events ) and the world (The underlying environment, rules, systems, geographies, histories, cultures etc ); arguing that the world-building is an ongoing system-level art rather than a single creative process, the foundation from which stories are built. A single world could be host to a myriad of stories. Changes done to the very foundation ripples across media forms and affects the progress of other stories built upon the same foundation or a single story being told across different media.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">A good example is  where the world foundation has outgrown the original story it supported. It has expanded and goes beyond a simple narrative about “a boy with a scar” into a sprawling transmedia creation. As  and   described, ‘transmedia storytelling’ disperses a narrative across multiple platforms, with each new text contributing distinct elements to a shared universe. What this paper describes as Synthetic Truths. What began as seven novels charting Harry’s coming-of-age has since expanded into a network of stories that are often interlinked yet they aren’t necessarily narratively contingent upon one another: the  film series,  stage play, spin-off books like  and , video games, theme park experiences, and lore-focused platforms such as . These works often do not center Harry at all but are still stories that operate within the same Wizarding World framework; making the original books just one narrative thread among many that rely on the Wizarding World foundation to tell their stories. This shift illustrates how a fictional property can outgrow its genesis story and become a persistent, multi-author world, where managing continuity and canon becomes significantly more complex.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Narratology, especially when viewed through the lenses of structural narratology, grounds part of the theoretical framework of this research and the novel solution derived from it. Structural narratology as described by  , compartmentalizes story narration into analyzable component structures such as plots, timelines and arcs. This decomposition of Narration enables a systematic evaluation of internal consistency across different narrative dimensions such as settings, characters and themes. By viewing stories as structured systems, narratology makes it possible to identify and assess logical coherence within fictional texts.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">This study also builds upon the findings of  Cognitive Narratology, where the focus expands from the sphere of narrative creation and into the domain of reader reception.  argue that readers mentally construct meaning while interacting with a story. This can be viewed as readers simulating worlds of the literal narratives they read in which the elements of the narrative form core logics of the world. Violating this inferred narrative coherent truth, such as unexplained contradiction, disrupts immersion, weakening the narrative.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Innovation for the proposed solution comes from a recent empirical study by the  in collaboration with  UK  which provides a strong precedent for the use of large language models in qualitative narrative analysis. The researchers tested two models (Claude and GPT-o1) against human analysts on a corpus of 138 short stories written by young people. Each model replicated the analytic steps of human narrative research, with findings judged to be both credible and thorough. Notably, the models also generated ‘additional interpretive insights’ that enhanced the ‘human’ analysis, suggesting that LLMs can function not only as replicators but as augmenters of traditional qualitative approaches.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Though their study raises important questions on ethical governance and methodological transparency, this is only in relation to the extrapolation of this study into other facets of the real world and not this study’s current focus, which is the Authoring of fictional worlds. What their study brought to light, however, was the potential of LLMs to strengthen not only research quality and efficiency through narrative analysis but also the quality and speed of narrative stability verification and management of canon sprawls.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Earlier, the term Synthetic Truth was used. ‘Synthetic’  according to Wiki, is defined as “that which is Artificial, Not Genuine.” While ‘Truth’  is ‘genuine depiction or statements of reality.’ Together, Synthetic Truth (S.T) stands to mean ‘Statements of reality within the confines of an imagined universe.’ The very building blocks that make up the foundations upon which stories are built.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">argue that, should we compartmentalize the abilities of the cognitive agent block, then ‘creativity’ would be packaged as one of many services to be called upon by the block. The paper further contrasts these cognitive services with modular, distributed web systems; suggesting that they both exhibit the same complexities in implementation, diversity and structure.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">explored the feasibility of Artificial Intelligence modeling creativity. A.I showed its competence in analyzing existing creative products such as jokes and computing possible new products of creativity. The paper established two major problems that stood in the way of AI creativity: a lack of domain expertise and AI’s inability to evaluate its own creativity.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Both papers give credence to the proposed research. Combining what these two entities do best resolves the bottlenecks faced by them individually. Authors, studios and creative teams fill the role of creativity while LLMs alleviates the computable cognitive burdens that come with being a creative.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Explores some of the greatest modern fictional works like , ,  and  with their sprawling worlds, complex histories and intersecting storylines. These stories’ complexities were so grand that  also explored how authors saw it necessary for “Collaborative Worldbuilding for Writers and Gamers”, describing how writers can co-create vast worlds for use of their own stories.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">This paper aims to prove that every author could potentially create one of these grand worlds by making use of AI as the cement holding their story together.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">finds it necessary to split world-building into two branches. The first branch focuses on the architecture of a world while the second branch explores how the disparate building blocks interact with each in both explicit and implied ways.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Hence world building becomes an iterative process where the author reviews both branches to not only flesh out the story but also review strategies, maps, ideological and political approaches.</p>
<h1 id="chapter-3-research-methodologies-and-tools" class="mt-10 scroll-mt-24 font-semibold tracking-tight text-foreground text-2xl">Chapter 3: RESEARCH METHODOLOGIES AND TOOLS</h1>
<h2 id="research-design" class="mt-9 scroll-mt-24 font-semibold tracking-tight text-foreground text-xl">Research Design</h2>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">This project will take on a hybrid approach. A combination of Object-Oriented software development and Top-Down planning and designing.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">The system will process a curated dataset of fictional texts –Including both consistent and intentionally flawed narratives — to demonstrate the software&#x27;s ability to detect contradictions, lore violations, and semantic inconsistencies.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">was used to create the illustrations included throughout this research.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">The following metrics will inform the quantitative aspects:</p>
<h3 id="synthetic-truth-logic-consistency-score-stlcs" class="mt-7 scroll-mt-24 font-semibold tracking-tight text-foreground text-lg">Synthetic Truth Logic Consistency Score (STLCS)</h3>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">A set of S.T laws; ─for example gravity, energy conservation, biological evolution, chemical reactions─ shall be assigned a consistency score (0-100) by the AI based on the number of violations detected in a story. (Consider adding name as author- all equations have been designed by author- part of contribution)</p>
<p class="mt-3 text-xs text-muted-foreground italic">Equation 1: Synthetic Truth Logical Consistency Score (STLCS)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Example: 4 violations out of 10 S.T statements then the result shall be 60% Consistency.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">This is further divided into Physical Violations, Chemical Violations, Biological violations, Timeline Violations, Technological Violations, Economical Violations, Knowledge Violations and Medical Violations.</p>
<h3 id="continuity-accuracy-metric-cam" class="mt-7 scroll-mt-24 font-semibold tracking-tight text-foreground text-lg">Continuity Accuracy Metric (CAM)</h3>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">This measures crucial details across a story such as object states, character positioning, room orientation or scene descriptions if they’ve been mentioned more than once.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">State Loging shall keep track of these details across chapters and compare them to their last known states. Illogical Contradictions based on the established S.T laws shall be flagged.</p>
<p class="mt-3 text-xs text-muted-foreground italic">Equation 2: Continuity Accuracy Metric (CAM)</p>
<h3 id="canon-adherence-score-cas" class="mt-7 scroll-mt-24 font-semibold tracking-tight text-foreground text-lg">Canon Adherence Score (CAS)</h3>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Canon Adherence Score is a measure about fiction-specific laws: races, histories, artifact.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Definition: Canon facts are statements the text has previously defined as absolute within its fictional world.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Example: “Only elves can wield the Moonblade.”</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Which is calculated by:</p>
<p class="mt-3 text-xs text-muted-foreground italic">Equation 3:Canon Adherence Score (CAS)</p>
<h3 id="world-integrity-score-wis" class="mt-7 scroll-mt-24 font-semibold tracking-tight text-foreground text-lg">World Integrity Score (WIS)</h3>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">World elements such as location, climate, cultural norms, geographical elements, physical laws, political borders and power structures shall be vectorized. WIS is a measure of the average semantic deviation of these vectorized elements over multiple mentions of it in the story.</p>
<p class="mt-3 text-xs text-muted-foreground italic">Equation 4: 3.1.4	World Integrity Score (WIS)</p>
<h3 id="objective-1-plot-consistency-stlcs" class="mt-7 scroll-mt-24 font-semibold tracking-tight text-foreground text-lg">OBJECTIVE 1: PLOT CONSISTENCY (STLCS)</h3>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Plot consistency is the evaluation of whether story events remain logically consistent with previously established narrative claims. This includes character actions, cause-and-effect relationships, and continuity of events across chapters.
A contradiction occurs when a later event invalidates or reverses an earlier claim without explanation (e.g., “The Sword of Alchemy was destroyed.” → “Aran drew the Sword of Alchemy.”).</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Implementation methods considered:</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Event Timeline Tracking: Manually or automatically constructing a timeline of events, then testing each new event against the timeline.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Causal Link Modeling: Using LLMs to infer causal dependencies (“X happens because Y”), and flagging violations when causes are ignored.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Claim Extraction + Contradiction Detection (chosen approach): Extract all critical claims from each chapter, then compare new content against stored claims to detect contradictions.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">The third approach mirrors how readers process stories: they form mental “claims” (facts about what has happened, what is true or what is considered relevant) and updates them as the story progresses. The LLM automatically extracts such claims in forms like:</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">“X is alive” / “X died”</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">“The artifact was destroyed” / “The artifact is being used”</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">“A journey takes weeks” / “The same journey was completed in a day”</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Contradiction detection is performed by comparing new chapter claims with the previously extracted set. This yields both:</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Score (STLCS): percentage of claims violated.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Violations: explicit contradictions (stored with claim, conflict segment, GPT reasoning).</p>
<h3 id="objective-2-canon-adherence" class="mt-7 scroll-mt-24 font-semibold tracking-tight text-foreground text-lg">OBJECTIVE 2: CANON ADHERENCE</h3>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Canon adherence is the measure of new story contents against previously established Synthetic truths. ( Facts of the Fictional World. ) For example: species traits and historical events. These Synthetic truths determine how the world functions and violation of them breaks the internal logical consistency of the narrative.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Three implementation methods were considered:</p>
<ul class="mt-3 list-disc pl-6"><li class="mt-1 text-sm text-muted-foreground leading-relaxed">Manual Canon Curation: Defining the world rules in the first two chapters, against which new story elements would be scrutinized against.</li></ul>
<p class="mt-3 text-xs text-muted-foreground italic">Figure 3-1: Manual Canon Curation</p>
<ul class="mt-3 list-disc pl-6"><li class="mt-1 text-sm text-muted-foreground leading-relaxed">Automated Canon Curation: Let the LLM extract the facts from early chapters and store them under the “Canon” category.</li></ul>
<p class="mt-3 text-xs text-muted-foreground italic">Figure 3-2: Automated Canon Curation</p>
<ul class="mt-3 list-disc pl-6"><li class="mt-1 text-sm text-muted-foreground leading-relaxed">Automated Extraction of Elements of Certainty: Let the LLM extract Synthetic Truths in the form of phrases of certainty. Example: “Magical beasts’ Evolved forms have no eyes.”</li></ul>
<p class="mt-3 text-xs text-muted-foreground italic">Figure 3-3: Canon Adherence Through LLM</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">The third, hybrid-approach, which is one of this paper’s novel contributions, was chosen since few authors define the entirety of the world within the first couple of chapters. Instead, it’s often an evolving world. Some important lores are revealed later in stories making automated curation from the first couple of chapters inadequate.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Proceeding with the third methodology, there are three sentence structures the LLM will be on lookout for:</p>
<ul class="mt-3 list-disc pl-6"><li class="mt-1 text-sm text-muted-foreground leading-relaxed">General Truths in the fictional world. Example: “Pink Martian skins.”</li><li class="mt-1 text-sm text-muted-foreground leading-relaxed">Confident declarations by narrators or by characters.</li><li class="mt-1 text-sm text-muted-foreground leading-relaxed">Definition of rules, abilities, races and limits.</li></ul>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Common canonical phrasing patterns that shall be considered are:</p>
<ul class="mt-3 list-disc pl-6"><li class="mt-1 text-sm text-muted-foreground leading-relaxed">[Entity] are [Property] : &quot;Zaratans are blind&quot;</li><li class="mt-1 text-sm text-muted-foreground leading-relaxed">[Concept] always [Behavior] : &quot;Cosmic mana always requires sunlight&quot;</li><li class="mt-1 text-sm text-muted-foreground leading-relaxed">[Group] cannot [Action] : &quot;Zaratans cannot see&quot;</li><li class="mt-1 text-sm text-muted-foreground leading-relaxed">No one can [Action] without [Condition] : &quot;No one can use magic without a conduit&quot;</li><li class="mt-1 text-sm text-muted-foreground leading-relaxed">Only [X] can [Y] : &quot;Only queens can enter the throne room&quot;</li><li class="mt-1 text-sm text-muted-foreground leading-relaxed">It is impossible to [Action] : &quot;It is impossible to breathe on Mars without a suit&quot;</li></ul>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">The methodology to achieve objective 2 shall boil down to mirroring a reader’s mental process:</p>
<p class="mt-3 text-xs text-muted-foreground italic">Figure 3-4: Reader&#x27;s Mental Process</p>
<p class="mt-3 text-xs text-muted-foreground italic">Figure 3-5: World Engine Simulation of Reader&#x27;s Mental Process</p>
<h3 id="objective-3-continuity-accuracy" class="mt-7 scroll-mt-24 font-semibold tracking-tight text-foreground text-lg">OBJECTIVE 3: CONTINUITY ACCURACY</h3>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Continuity accuracy ensures consistency of details across a story. Details such as names, places, timelines, and descriptive facts are elements easily forgotten. Unlike canon (world truths) and plot (event causality), continuity focuses on factual details that should remain stable once introduced. For example:</p>
<ul class="mt-3 list-disc pl-6"><li class="mt-1 text-sm text-muted-foreground leading-relaxed">A character’s eye color, weapon or name changing mid-story without explanation.</li><li class="mt-1 text-sm text-muted-foreground leading-relaxed">Distances and travel times shifting inconsistently.</li><li class="mt-1 text-sm text-muted-foreground leading-relaxed">Dates, ages, or titles mismatching across chapters.</li></ul>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Three implementation methods were considered:</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Index-based Tracking: Storing all details in a structured index (characters, items, places), then flagging mismatches.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Vector Embedding Search: Embedding continuity claims and searching for near matches when new content appears, to detect mismatches.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Hybrid Extraction + Comparison (chosen approach): Extract continuity facts per chapter, embed them, and compare against all stored facts to flag inconsistencies.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Hybrid Extraction + Comparison
The LLM extracts “continuity facts” expressed in stable forms like:</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">“[Entity] has [Property]” (e.g., “Ola has blue eyes, Orange hair and fair skin”).</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">“[Place] is located in [Region]”. (e.g. ).</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">“[Time period] lasted [Duration]”. (e.g The waning era lasted three hundred years.)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Later text is scrutinized against this ‘database of facts’. Violations are then spotted and returned as:</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Established Fact: which is the original claim.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Conflict Segment: The passage causing contradiction.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Explanation: The LLM reasoning when flagging the event as a violation of continuity.</p>
<h3 id="objective-4-world-building-integrity" class="mt-7 scroll-mt-24 font-semibold tracking-tight text-foreground text-lg">OBJECTIVE 4: WORLD BUILDING INTEGRITY</h3>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">This involves the measure of a story remaining true to the systems that are its underlying framework. Example: Power Systems, Ruling systems, Magic Systems, Economic Systems, Justice Systems.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Implementation methods considered:</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Rule-First Author Annotation: Authors manually define rules (e.g., “magic requires mana”), against which violations are checked.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Automated Rule Extraction from Narrative: LLMs extract “if-then” or “only-when” structures that imply rules.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Hybrid Rule+Violation Evaluation (chosen approach): Extract rules automatically, track them, then check story content for violations.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">This research went ahead with the hybrid solution. The LLM will search for rule-like phrasings:</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">“Only X can Y” → “Only priests can enter the temple.”</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">“To do X, Y is required” → “To cast fire magic, spark mana is required.”</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">“It is forbidden to X” → “It is forbidden to carry weapons in the palace.”</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Violations would be flagged when new content breaks these established constraints without explanation. Results include:</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">List of rules and systems (worldbuilding skeleton such as currency, history, rulership philosophy etc).</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Integrity score (WIS score).</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Violations (rule broken, conflict segment, GPT explanation).</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">This mirrors a reader’s sense of immersion: once the rules of a fictional world are understood, any unacknowledged violation immediately weakens believability.</p>
<h3 id="summary" class="mt-7 scroll-mt-24 font-semibold tracking-tight text-foreground text-lg">SUMMARY</h3>
<p class="mt-3 text-xs text-muted-foreground italic">Table 1: A summary of Methodology for each Objective</p>
<div class="mt-4 overflow-x-auto rounded-2xl border border-border/70 bg-card">
  <table class="min-w-full border-separate border-spacing-0">
    <thead class="bg-muted/50">
      <tr><th class="whitespace-nowrap px-3 py-2 text-left text-xs font-semibold text-foreground">OBJECTIVE</th><th class="whitespace-nowrap px-3 py-2 text-left text-xs font-semibold text-foreground">EXTRACTS FROM TEXT</th><th class="whitespace-nowrap px-3 py-2 text-left text-xs font-semibold text-foreground">CHECKS FOR</th><th class="whitespace-nowrap px-3 py-2 text-left text-xs font-semibold text-foreground">EXAMPLE VIOLATION</th></tr>
    </thead>
    <tbody><tr class="border-t border-border/70"><td class="px-3 py-2 align-top text-sm text-muted-foreground">Plot Consistency</td><td class="px-3 py-2 align-top text-sm text-muted-foreground">Factual claims/events</td><td class="px-3 py-2 align-top text-sm text-muted-foreground">Logical contradictions</td><td class="px-3 py-2 align-top text-sm text-muted-foreground">Dead king suddenly speaks again</td></tr><tr class="border-t border-border/70"><td class="px-3 py-2 align-top text-sm text-muted-foreground">Canon Adherence</td><td class="px-3 py-2 align-top text-sm text-muted-foreground">Hard canon facts</td><td class="px-3 py-2 align-top text-sm text-muted-foreground">Breaks of lore</td><td class="px-3 py-2 align-top text-sm text-muted-foreground">Human uses elf-only artifact</td></tr><tr class="border-t border-border/70"><td class="px-3 py-2 align-top text-sm text-muted-foreground">Worldbuilding Integrity</td><td class="px-3 py-2 align-top text-sm text-muted-foreground">Systemic rules/mechanics</td><td class="px-3 py-2 align-top text-sm text-muted-foreground">Physics/magic/economy broken</td><td class="px-3 py-2 align-top text-sm text-muted-foreground">Magic working in void space when it shouldn&#x27;t</td></tr><tr class="border-t border-border/70"><td class="px-3 py-2 align-top text-sm text-muted-foreground">Continuity Accuracy</td><td class="px-3 py-2 align-top text-sm text-muted-foreground">Character/state/timeline facts</td><td class="px-3 py-2 align-top text-sm text-muted-foreground">Inconsistencies in state/timing</td><td class="px-3 py-2 align-top text-sm text-muted-foreground">Item lost in Ch3 reappears in Ch6 unaddressed</td></tr></tbody>
  </table>
</div>
<h1 id="chapter-4-design-and-development" class="mt-10 scroll-mt-24 font-semibold tracking-tight text-foreground text-2xl">Chapter 4: Design and Development</h1>
<h2 id="introduction" class="mt-9 scroll-mt-24 font-semibold tracking-tight text-foreground text-xl">Introduction</h2>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">At the highest level, the front end receives the text file from the user. It then sends the file to an API, which then sends the text information to the backend. The backend houses other Django applications. The one that receives the text from the file is called Core. Within Core are functions that are dedicated to meeting this research’s objectives.</p>
<p class="mt-3 text-xs text-muted-foreground italic">Figure 4-1: Story upload and Processing Sequence</p>
<p class="mt-3 text-xs text-muted-foreground italic">Figure 4-2: API Request Processing Sequence</p>
<h2 id="results-presentation" class="mt-9 scroll-mt-24 font-semibold tracking-tight text-foreground text-xl">Results Presentation</h2>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">The frontend was developed in  with  as the build tool and  for styling. Its primary role is to present the outputs of the analysis functions and their respective metrics (e.g., evaluate_plot_consistency, evaluate_canon_adherence, evaluate_continuity_accuracy, and evaluate_world_integrity).</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">The design was built around three principles:</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Transparency – This involves showing the reasoning steps taking place and involves elements such as claims, conflicts, LLM reasoning explanations.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Readability – Large volumes of text need structuring such as pagination and collapsible cells.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Traceability – Each result links back to its originating “Synthetic Truth” for easy inspection.</p>
<h3 id="component-structure" class="mt-7 scroll-mt-24 font-semibold tracking-tight text-foreground text-lg">Component Structure</h3>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Each research objective is represented by a dedicated React component:</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">STLCS.jsx (Plot Consistency)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Canon.jsx (Canon Adherence)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">ContinuityTable.jsx (Continuity Accuracy)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">WorldIntegrityResults.jsx (Worldbuilding Integrity)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Each of these follows the same high-level structure:</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Render the metric score in a highlighted card or table.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Show extracted Synthetic Truths (rules, canon elements, continuity details).</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Display violations of Synthetic Truths in a tabular format.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Interactive features such as collapsible cells and pagination.</p>
<h3 id="key-features" class="mt-7 scroll-mt-24 font-semibold tracking-tight text-foreground text-lg">Key Features</h3>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Chunk-Level Fact Presentation
Extracted rules and facts (e.g., “Martians cannot see”) are rendered in list or table format. They are color-coded based on whether they are respected or violated.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">&lt;td className={violated ? &quot;text-red-600&quot; : &quot;text-green-600&quot;}&gt;</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">{violated ? &quot;Violated&quot; : &quot;Respected&quot;}</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">&lt;/td&gt;</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Collapsible Conflict Segments
Violating text segments can be lengthy. To avoid overwhelming the reader, they are truncated with a “Show more / Show less” toggle. This let’s the author glance over results but diving deeper when needed.</p>
<p class="mt-3 text-xs text-muted-foreground italic">Equation 5: Collapsible Conflict Segment</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">const [expanded, setExpanded] = useState(false);</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">&lt;div onClick={() =&gt; setExpanded(!expanded)}&gt;</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">{expanded ? conflict : conflict.slice(0, 120) + &quot;...&quot;}</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">&lt;/div&gt;</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Pagination for Violations
Some stories generate dozens of violations. Pagination was added to maintain a clean interface while still allowing full inspection.</p>
<p class="mt-3 text-xs text-muted-foreground italic">Equation 6: Pagination of Violations</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">const perPage = 10;</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">const currentViolations = violations.slice((page-1)*perPage, page*perPage);</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Inline Loading Indicators
Background tasks (story uploads, evaluation) can take time. An inline loader (&lt;Loader /&gt;) was included to communicate progress to the user, preventing uncertainty when they are left in limbo while the program runs.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Example: World Integrity Results</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">A key React component is WorldIntegrityResults.jsx. This aggregates the World Integrity Score (WIS), lists the rules extracted from the story, and paginates through violations. The layout is designed so a researcher can immediately see:</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">The global integrity score.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">What rules were assumed.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Where those rules were broken.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">This mirrors the backend logic (fact extraction → embedding → contradiction check), but presents it in a human-readable flow.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">All in all, the frontend was designed to mirror the percieved cognitive process of a critic looking for flaws or a dedicated audience:</p>
<ul class="mt-3 list-disc pl-6"><li class="mt-1 text-sm text-muted-foreground leading-relaxed">Recall established rules (Extracted Facts).</li></ul>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Skim for contradictions (Violation List).</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Drill down when inconsistencies appear (Collapsible Conflicts).</p>
<h2 id="objective-1-plot-consistency" class="mt-9 scroll-mt-24 font-semibold tracking-tight text-foreground text-xl">Objective 1: PLOT CONSISTENCY</h2>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">evaluate_plot_consistency(text) was the first function to have been developed to meet the first objective of this research. The function must investigate the text, find new events within the story, then look for parts that contradict earlier stated facts without a linking causality hence violating the synthetic truth of the world.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">The flow of logic within this public function is in three parts:</p>
<ul class="mt-3 list-disc pl-6"><li class="mt-1 text-sm text-muted-foreground leading-relaxed">Extract important claims</li><li class="mt-1 text-sm text-muted-foreground leading-relaxed">Store them as facts semantically</li><li class="mt-1 text-sm text-muted-foreground leading-relaxed">Compare later chunks to detect logical contradictions.</li></ul>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">These logical parts were then programmed into private methods.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">split_into_chunks(text): The text is spilt into chunks of a thousand (1000) words which allows for long text analysis in manageable chunks. There is also a limit on context/tokens LLMs and embeddings have, so working in sections keeps processing efficient.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">extract_critical_claims(chunk): Direct usage of OpenAI’s ChatGPT, though convenient, is expensive. Therefore, indirect usage of the resource through Microsoft Azure OpenAI which offers 200$ credit to new users, was necessary.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Important facts are extracted from these chunks which will later be used to determine whether a plot consistency violation has occurred, a measure of which gives STLCS.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Example:</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">“In Chapter 4, she removes her helmet on Mars and says, ‘I can breathe here’.”</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Response:</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">- Claim: The atmosphere on Mars is breathable without a helmet.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">- Source: “she removes her helmet on Mars…”</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">- Reason: This defines a Synthetic Truth physical law –(A Physical law that remains true only in context of the fictional world).</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">store_fact(category, text, chapter, story_id=&quot;default&quot;): The extracted Synthetic Truths are embedded via Azure text-embedding-ada-002 and stored in Pinecone. Metadata passed in the function tags each identified Synthetic Truth with categories such as Plot and Chapter number i.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">The reason we go with vector embedding instead of traditional database storage is that we need the retrieval of similar ideas even when worded differently. This is essential in our use-case as we aren’t searching for contradictions yet. Instead, we are grouping similar ideas even when phrased or expressed differently.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Once this is done, we loop through all chunks while comparing every newer chunk’s Synthetic Truths to previous ones. Having determined the direction of investigation, the actual search is done through a vector search. This shall pull synthetic truths that are semantically close to the current chunk.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">This is referred to as inter-chunk consistency checks which are checks across multiple chunks.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Intra-chunk consistency checks are unnecessary since they add unneeded complexity to the project while having very little impact. The chunks are already split into approximately a thousand words, which is the approximate length of a chapter. An author is capable of maintaining local consistency within such a small scope, because contradictions inside a single scene are rare compared to narrative contradictions across the entire story. Most violations worth detecting (plot holes, canon violations, Continuity errors, world systems breaks) only emerge over multiple chunks.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">is_contradiction(claim, chunk): Another request is then posted to gpt-35-turbo-evaluator, and within it, we pass the both the synthetic truth and the identified chunk that is semantically close. This second request is necessary since, even though a vector search brings related context together, only gpt-35-turbo-evaluator can apply nuanced reasoning to tell whether the events are contradictory.</p>
<p class="mt-3 text-xs text-muted-foreground italic">Figure 4-3: Plot Consistency Implementation Analogy</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">evaluate_plot_consistency(text): follows how a reader reasons while reading a story. First, they vaguely remember what they know about an event or the world itself, then they compare these vague memories to new events within the story and finally, they reason whether the new event makes sense.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Azure embedding model ─ embedding-ada-002 ─ extracts the meaning of a Synthetic Truth and not the Synthetic Truth itself. This meaning is then stored in pinecone. Pinecone grants us the capability to remember meanings that are closely related or directly connected. This is similar to how a reader has vague memories of the events or world in general. Vectors in close proximity to each other could indicate semantically related or potentially contradictory contexts.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Therefore, a second call to gpt-35-turbo-evaluator will apply causal reasoning to determine whether a contradiction exists between the passed vectors.</p>
<p class="mt-3 text-xs text-muted-foreground italic">Figure 4-4: A summary of Plot Consistency Implementation</p>
<h2 id="objective-2-canon-adherance" class="mt-9 scroll-mt-24 font-semibold tracking-tight text-foreground text-xl">Objective 2: CANON ADHERANCE</h2>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">chunks = split_into_chunks(text)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">The text is split into chunks to allow for fine-grained analysis.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">canon_facts = extract_canon_facts(chunk)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">A prompt is used to extract only authoritative statements. Synthetic truths that serve as permanent pillars that hold up the story. Examples: Physics, magic, science</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Example response from model:</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">- Canon Fact: Sun mana requires direct sunlight</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">- Canon Fact: Humans cannot breathe on Mars unaided</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">store_fact(&quot;canon&quot;, fact, chapter=i, story_id=story_id)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">After the canon facts are extracted, they are converted to vectors by Azure’s text-embedding-ada-002 which are then stored in pinecone. The story id was added later in order to differentiate between canon facts in different stories. This function is a reflection of a reader’s internalization process of world rules.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">canon_vectors = search_nearby(category=&quot;canon&quot;, text=&quot;canon&quot;, story_id=story_id)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">We now retrieve all that we know about the world and create a world model. Each story chunk is evaluated against the world model. The check is carried out by a prompt designed to identify contradiction.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Example:</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Canon Fact: Sun mana requires direct sunlight</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Story Segment: The mage cast a sun mana spell deep inside the cave.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">&quot;Yes, the story contradicts the canon because sun mana needs sunlight, and no such condition is mentioned in the cave.&quot;</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Every contradiction is logged for the author’s evaluation. Within the log; the excerpt, the canon violation and gpt-35-turbo-evaluator’s reasoning are recorded.</p>
<p class="mt-3 text-xs text-muted-foreground italic">Figure 4-5: A summary of Canon Adherence Implementation</p>
<h2 id="objective-3-continuity-accuracy-2" class="mt-9 scroll-mt-24 font-semibold tracking-tight text-foreground text-xl">Objective 3: CONTINUITY ACCURACY</h2>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">chunks = split_into_chunks(text): The text is first split into thousand-word chunks to allow for fine-grained analysis. This allows for tracking of stateful information such as characters, objects, locations or timelines across a narrative.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">continuity_facts = extract_continuity_facts(chunk): A prompt is used to extract all states defined or mentioned in each chunk. These include any declarations of position, condition, possession, time, or relationships. These are, essence, information that has to remain consistent across chapters similar to how reality remains similar unless acted upon by outside influence. For example, A cup left on the table in the evening, it is expected that said cup is still on the table the morning after unless acted upon by an external influence.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Example of responses from the model:</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Continuity Fact: John’s sword was completely destroyed.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Continuity Fact: The queen is currently in hiding.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Continuity Fact: The crew’s ship had a leak after the battle.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">store_fact(&quot;continuity&quot;, fact, chapter=i, story_id=story_id):These extracted state facts are embedded with  and stored in . Metadata tags each fact with its chapter and story ID. This mirrors how a reader stores mental bookmarks of “current known states” as they read.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">all_facts = search_nearby(category=&quot;continuity&quot;, text=&quot;continuity&quot;, story_id=story_id): All known continuity facts are then retrieved to build a state map of the world so far. Each new chunk is evaluated against this map using a specialized continuity contradiction prompt.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Example:</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Continuity Fact: “John’s sword was blasted to smithereens!” (Happened in Chapter 3)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Story Segment: John parried the attack with his sword. (Happening in Chapter 6)
Response:
“Yes, this contradicts continuity: the sword was said to be destroyed in Chapter 3, yet it is used here as if intact.”</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Each violation is logged for the author’s review. Logs include: the violated fact, the conflicting excerpt, and GPT-35-Turbo-Evaluator’s reasoning.</p>
<p class="mt-3 text-xs text-muted-foreground italic">Figure 4-6: A summary of Continuity Accuracy Implementation</p>
<h2 id="objective-4-world-building-integrity-2" class="mt-9 scroll-mt-24 font-semibold tracking-tight text-foreground text-xl">Objective 4: WORLD BUILDING INTEGRITY</h2>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">chunks = split_into_chunks(text): The story is once again first split into thousand-word chunks to enable capilary analysis of the underlying mechanics of the world –Including its economy, climate systems, political hierarchies, and other global structures that must remain logically consistent.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">world_rules = extract_worldbuilding_rules(chunk): A dedicated prompt then extracts foundational world rules from each chunk. These are systemic principles that govern how the world or universe operates and function as Sythentic Truths. They include elements such as currency, trade, laws, power or energy systems. These are all systems expected to remain consistent throughout the narrative or until an external influence acts upon them.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Below is a sample of the model’s example response:</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">World Rule: Crystal Shards are the only form of legal currency.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">World Rule: 100 Shards = 1 Gold Bar.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">World Rule: Foreign paper money has no value within the empire.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">World Rule: The empire’s treasury strictly controls the supply of Crystal Shards.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">store_fact(&quot;integrity&quot;, rule, chapter=chapter_title, story_id=&quot;default&quot;): Each extracted rule is embedded via Azure’s text-embedding-ada-002 and stored in Pinecone under the WIS category and tagged with chapter and story ID. This step represents how a reader slowly builds a mental map of how the world systems work as they read.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">integrity_vectors = search_nearby(category=&quot;integrity&quot;, text=&quot;rule&quot;, top_k=50): Once stored, all known rules are retrieved to construct a semantic world model. Each new chunk is then checked against this model using a world integrity contradiction prompt that flags any content that breaks the logic of the world’s systems.</p>
<p class="mt-3 text-xs text-muted-foreground italic">Figure 4-7: Logical Flow of events while checking for World Rule Violations</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Example:</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">World Rule: Crystal Shards are the only legal currency.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Story Segment: The merchant prized the sword at “500 gold coins”.
Response:
“Yes, this violates worldbuilding integrity because gold coins were never introduced as valid currency, contradicting the established economic rules.”</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Every violation is logged, recording the segment, the violated world rule, and GPT-35-Turbo-Evaluator’s reasoning.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">The WIS is then calculated and given as a percentage score response reflecting how consistently the story adheres to its own defined world systems.</p>
<p class="mt-3 text-xs text-muted-foreground italic">Figure 4-8: A summary of World Building Integrity Implementation</p>
<h2 id="summary-2" class="mt-9 scroll-mt-24 font-semibold tracking-tight text-foreground text-xl">SUMMARY</h2>
<p class="mt-3 text-xs text-muted-foreground italic">Figure 4-9: A Concise Summary of All Objective Implementation</p>
<h1 id="chapter-5-implementation-and-testing" class="mt-10 scroll-mt-24 font-semibold tracking-tight text-foreground text-2xl">Chapter 5: Implementation and Testing</h1>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">The system was implemented as a two-tier application, comprising a Django REST API backend and a React (Vite + TailwindCSS) frontend. The backend housed the four evaluation functions — evaluate_plot_consistency, evaluate_canon_adherence, evaluate_continuity_accuracy, and evaluate_world_integrity. Each function operationalized the conceptual design discussed in Chapter 3.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">For instance, the plot consistency function follows the logic described in Section 3.2:</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Splitting the text into chunks (split_into_chunks) for manageable analysis.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Extracting claims (extract_critical_claims) via an LLM hosted on Azure OpenAI.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Embedding claims using text-embedding-ada-002 and storing them in Pinecone with chapter-level metadata.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Cross-checking claims from earlier chunks against later ones through a semantic search (search_nearby).</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Contradiction detection (is_contradiction) where GPT-4o-mini applies reasoning to judge violations.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">This process translated directly into Python functions.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">On the frontend, these results were displayed in interactive tables with pagination, collapsible cells for long conflicts, and status indicators for respected vs. violated facts. This allowed for an interpretable presentation layer for testing and validation.</p>
<h2 id="testing-strategy" class="mt-9 scroll-mt-24 font-semibold tracking-tight text-foreground text-xl">Testing Strategy</h2>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">The testing phase was structured around three major parts: unit-level testing, end-to-end integration testing, and simulation evaluation using real short stories from novice authors.</p>
<h3 id="unit-testing" class="mt-7 scroll-mt-24 font-semibold tracking-tight text-foreground text-lg">Unit Testing</h3>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Unit tests targeted private methods that collectively powered each objective’s analysis pipeline. These functions are foundational blocks of the WIE, and ensuring their correctness was essential before testing higher-level behaviors.</p>
<p class="mt-3 text-xs text-muted-foreground italic">Table 2: Unit Testing on Key Functions</p>
<div class="mt-4 overflow-x-auto rounded-2xl border border-border/70 bg-card">
  <table class="min-w-full border-separate border-spacing-0">
    <thead class="bg-muted/50">
      <tr><th class="whitespace-nowrap px-3 py-2 text-left text-xs font-semibold text-foreground">FUNCTION</th><th class="whitespace-nowrap px-3 py-2 text-left text-xs font-semibold text-foreground">TEST PURPOSE</th><th class="whitespace-nowrap px-3 py-2 text-left text-xs font-semibold text-foreground">EXAMPLE TEST</th><th class="whitespace-nowrap px-3 py-2 text-left text-xs font-semibold text-foreground">EXPECTED RESULT</th></tr>
    </thead>
    <tbody><tr class="border-t border-border/70"><td class="px-3 py-2 align-top text-sm text-muted-foreground">embed_text</td><td class="px-3 py-2 align-top text-sm text-muted-foreground">Confirm embedding generation</td><td class="px-3 py-2 align-top text-sm text-muted-foreground">&quot;The sky is blue&quot;</td><td class="px-3 py-2 align-top text-sm text-muted-foreground">1536-d vector returned</td></tr><tr class="border-t border-border/70"><td class="px-3 py-2 align-top text-sm text-muted-foreground">store_fact</td><td class="px-3 py-2 align-top text-sm text-muted-foreground">Confirm correct insertion and metadata</td><td class="px-3 py-2 align-top text-sm text-muted-foreground">&quot;Dragons breathe fire&quot;</td><td class="px-3 py-2 align-top text-sm text-muted-foreground">Entry visible in Pinecone dashboard</td></tr><tr class="border-t border-border/70"><td class="px-3 py-2 align-top text-sm text-muted-foreground">search_nearby</td><td class="px-3 py-2 align-top text-sm text-muted-foreground">Confirm semantic retrieval and filtering</td><td class="px-3 py-2 align-top text-sm text-muted-foreground">search &quot;fire breath&quot; after storing above</td><td class="px-3 py-2 align-top text-sm text-muted-foreground">Returns “Dragons breathe fire&quot;</td></tr><tr class="border-t border-border/70"><td class="px-3 py-2 align-top text-sm text-muted-foreground">setup_logger</td><td class="px-3 py-2 align-top text-sm text-muted-foreground">Confirm log creation per book title</td><td class="px-3 py-2 align-top text-sm text-muted-foreground">&quot;The_Lost_Colony&quot;</td><td class="px-3 py-2 align-top text-sm text-muted-foreground">Creates logs/The_Lost_Colony_x.log</td></tr></tbody>
  </table>
</div>
<h3 id="system-integration-testing" class="mt-7 scroll-mt-24 font-semibold tracking-tight text-foreground text-lg">System Integration Testing</h3>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">System-level tests validated the interaction between the React front-end, the FastAPI backend, and the underlying evaluation modules. The aim was to confirm that the system could handle realistic user interactions and end-to-end flows.</p>
<h4 id="key-checks-performed" class="mt-6 scroll-mt-24 font-semibold tracking-tight text-foreground text-base">Key checks performed:</h4>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">React → API Integration</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Verified that file uploads were correctly transmitted using Axios and received as multipart form data.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Confirmed that the objective selection in the UI correctly mapped to the respective backend function (stlcs, canon, continuity, wis).</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Backend Orchestration</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Ensured that the correct evaluation pipeline was triggered, and that intermediate logs were created with filenames incorporating both the objective type and the uploaded book title for traceability.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Checked response structure from API: each evaluation returned a score, violations array, rules or array as expected.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Error Handling</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Uploaded unsupported file types and empty payloads to confirm that graceful error messages were returned to the front-end without crashing the server.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Simulated network interruptions to ensure Axios promise rejection was caught and displayed to the user.
Integration testing confirmed that all moving parts communicated correctly under realistic usage patterns, ensuring that failures in one layer (e.g., the API) did not cause silent failures in another (e.g., React UI).</p>
<h3 id="simulation-testing-with-short-stories" class="mt-7 scroll-mt-24 font-semibold tracking-tight text-foreground text-lg">Simulation Testing with Short Stories</h3>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Black-box simulation tests we finally carried out. The system’s ability to analyze real-world data under realistic operating conditions were evaluated.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">The set up included selected 5 publicly available short stories (2,000–10,000 words each) from community sources such as SpaceBattles forums that contained known continuity breaks, shifting world rules, or plot contradictions.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Each story was run through all four objectives (STLCS, Canon, Continuity, WIS).</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Testing Goals included:</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Output Structure Validation</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Each objective returned:</p>
<ul class="mt-3 list-disc pl-6"><li class="mt-1 text-sm text-muted-foreground leading-relaxed">A numerical score (0–100)</li><li class="mt-1 text-sm text-muted-foreground leading-relaxed">An array of violation objects :rule, reason, conflict, chapter, excerpt</li></ul>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Detection Quality Check:</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Verified that known contradictions were mostly flagged (e.g., an item lost in chapter 2 reappearing in chapter 6, or sudden shifts in the defined currency system).</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">This stage validated not just correctness, but real-world effectiveness; ensuring that the system could handle real narrative text at meaningful scales, while maintaining interpretability and robustness.</p>
<h2 id="results-presentation-2" class="mt-9 scroll-mt-24 font-semibold tracking-tight text-foreground text-xl">Results Presentation</h2>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Results were summarized numerically and visually:</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Scores: Synthetic Truth Logical Consistency Score (STLCS), Continuity Accuracy Metric (CAM), World Integrity Score (WIS), and Canon Adherence Percentage.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Tables: Extracted claims/facts alongside identified contradictions.</p>
<h2 id="story-1" class="mt-9 scroll-mt-24 font-semibold tracking-tight text-foreground text-xl">Story 1:</h2>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Word count: 39,383.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Canon Adherence Score (CAS): -4738%</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Beyond the Canon Adherence Score, the logs shows successful extraction of multiple canon facts.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Examples include:</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">“Dorothy lives in Kansas”</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">“The Yellow Brick Road leads to the Emerald City”</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">“The Scarecrow has no brain”</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">“The Tin Woodman has no heart”</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">These are properly recognized as permanent truths of the Wizard of Oz universe, which is correct for canon adherence checks.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Positive observations made while going through the logs were that extracted statements were concise and domain-relevant. Each of the Synthetic Truths were also formatted consistently for embedding and storage.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Few contradictions were also flagged, which could indicate that the book was generally well written with very few contradictions. Although it could also mean false negatives from the LLM.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">World Integrity Score (WIE): -4924%</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Plot consistency (STLCS): -4195%</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">The logs show successful extraction of multiple consistency claims such as:</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">“The Tin Woodman received a new heart made of silk and stuffed with sawdust from the Wizard of Oz.”</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">“The Wizard promises to give the Scarecrow brains, the Lion courage, and the Tin Woodman a heart.”</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">“The Cowardly Lion received courage in the form of a liquid from the Wizard of Oz.”</p>
<p class="mt-3 text-xs text-muted-foreground italic">Figure 5-1: Plot Consistency analysis sample on the Wizard of Oz</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Positive observations on this particular analysis was that the extracted claims were all consistency relevant.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Continuity accuracy (CAM) : -3900%</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">The analysis resulted in a -3900% CAM but very little continuity claims were extracted.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">“The road through the forest is rough and the yellow bricks are uneven, sometimes broken or missing, creating holes that Toto jumps across and Dorothy walks around.”</p>
<h2 id="story-2" class="mt-9 scroll-mt-24 font-semibold tracking-tight text-foreground text-xl">Story 2:</h2>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Canon Adherence Score (CAS): -2100%</p>
<p class="mt-3 text-xs text-muted-foreground italic">Table 3: A Sample of Canon extracts from The Strange Case of Dr. Jekyll and Mr. Hyde</p>
<div class="mt-4 overflow-x-auto rounded-2xl border border-border/70 bg-card">
  <table class="min-w-full border-separate border-spacing-0">
    <thead class="bg-muted/50">
      <tr><th class="whitespace-nowrap px-3 py-2 text-left text-xs font-semibold text-foreground">CANON FACT</th><th class="whitespace-nowrap px-3 py-2 text-left text-xs font-semibold text-foreground">STATUS</th></tr>
    </thead>
    <tbody><tr class="border-t border-border/70"><td class="px-3 py-2 align-top text-sm text-muted-foreground">Dr. Jekyll transforms into Mr. Hyde, two distinct personalities sharing the same body.</td><td class="px-3 py-2 align-top text-sm text-muted-foreground">Respected</td></tr><tr class="border-t border-border/70"><td class="px-3 py-2 align-top text-sm text-muted-foreground">Dr. Jekyll&#x27;s transformation into Mr. Hyde is triggered by a potion.</td><td class="px-3 py-2 align-top text-sm text-muted-foreground">Respected</td></tr><tr class="border-t border-border/70"><td class="px-3 py-2 align-top text-sm text-muted-foreground">Mr. Hyde has a strong hatred towards Dr. Jekyll and commits acts of sabotage against him.</td><td class="px-3 py-2 align-top text-sm text-muted-foreground">Respected</td></tr><tr class="border-t border-border/70"><td class="px-3 py-2 align-top text-sm text-muted-foreground">Dr. Jekyll experiences physical and mental deterioration due to the constant struggle between his two personalities.</td><td class="px-3 py-2 align-top text-sm text-muted-foreground">Respected</td></tr><tr class="border-t border-border/70"><td class="px-3 py-2 align-top text-sm text-muted-foreground">Dr. Jekyll&#x27;s supply of the potion that allows him to transform is running low, leading to a sense of impending doom.</td><td class="px-3 py-2 align-top text-sm text-muted-foreground">Respected</td></tr><tr class="border-t border-border/70"><td class="px-3 py-2 align-top text-sm text-muted-foreground">Dr. Jekyll fears that Mr. Hyde may destroy his written confession if he transforms before it is sealed.</td><td class="px-3 py-2 align-top text-sm text-muted-foreground">Respected</td></tr><tr class="border-t border-border/70"><td class="px-3 py-2 align-top text-sm text-muted-foreground">Dr. Jekyll is aware that his time to control his own thoughts and appearance is limited due to the dwindling supply of the potion.</td><td class="px-3 py-2 align-top text-sm text-muted-foreground">Respected</td></tr><tr class="border-t border-border/70"><td class="px-3 py-2 align-top text-sm text-muted-foreground">Mr. Utterson&#x27;s friendship is undemonstrative, founded on a catholicity of good-nature, and he accepts his friendly circle as it comes from opportunity.</td><td class="px-3 py-2 align-top text-sm text-muted-foreground">Violated</td></tr><tr class="border-t border-border/70"><td class="px-3 py-2 align-top text-sm text-muted-foreground">The character Lanyon has been exposed to supernatural or extraordinary events that have shaken his beliefs and caused him great distress.</td><td class="px-3 py-2 align-top text-sm text-muted-foreground">Violated</td></tr></tbody>
  </table>
</div>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">The identified violations have been observed to stem from the complex nature of human character where often at times, illogical decisions are made.</p>
<p class="mt-3 text-xs text-muted-foreground italic">Figure 5-2: A Sample Canon Synthetic Truth Extract from The Strange Case of Dr. Jekyll and Mr. Hyde</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Plot consistency (STLCS): -2000%</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Seventeen Claims were extracted from the text that constituted consistency checks.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">A sample of which is</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">The cheque presented by the man accused of harming the child was genuine, despite suspicions of forgery.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">- Source: &quot;I gave in the cheque myself, and said I had every reason to believe it was a forgery. Not a bit of it. The cheque was genuine.&quot;</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">- Reason: This claim is important as it resolves the uncertainty surrounding the authenticity of the cheque and confirms that the accused man did have the means to pay the blackmail amount.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Continuity accuracy (CAM) : -1328%</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Dozens of continuity-relevant details were extracted, some of which include:</p>
<ul class="mt-3 list-disc pl-6"><li class="mt-1 text-sm text-muted-foreground leading-relaxed">Poole describing cabinet footsteps (Chapter 8)</li></ul>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Jekyll creating a will for Hyde (Chapter 10)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Inspectors finding evidence in ashes (Chapter 4)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Lanyon’s deterioration (Chapter 6)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Jekyll’s duality reflections (Chapter 10)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">etc</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Each fact received a continuity alignment score ranging from 0.736 to 0.772, showing moderate internal consistency recognition.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">World Integrity Score (WIE): -1233%</p>
<h1 id="chapter-6-discussion-and-critical-appraisal-of-result" class="mt-10 scroll-mt-24 font-semibold tracking-tight text-foreground text-2xl">Chapter 6: Discussion and Critical Appraisal of Result</h1>
<h2 id="objective-1-plot-consistency-stlcs-2" class="mt-9 scroll-mt-24 font-semibold tracking-tight text-foreground text-xl">Objective 1 — Plot Consistency (STLCS)</h2>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">The system successfully extracted factual claims from narrative text and evaluated them for logical contradictions across chapters. This approach aligns conceptually with Veale and Li (2016) who model creativity as modular services and argued that computational agents can detect divergence patterns at scale.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Outcome: The WIE achieved consistent STLCS outputs across test stories, with contradiction detection correctly identifying non-causal reappearances or impossible events (e.g. dead characters returning without explanation).</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Novelty: Unlike previous work, which largely focused on creative text generation (Boden, 1998), this system operationalised creativity evaluation—using embeddings for semantic recall and GPT-based causal checks to detect violations.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Limitation: Some contradictions flagged were in fact foreshadowing or plot twists. This highlights the nuanced boundary between true logical contradiction and narrative surprise—a challenge noted also in Jenner et al. (2025).</p>
<h2 id="objective-2-canon-adherence-2" class="mt-9 scroll-mt-24 font-semibold tracking-tight text-foreground text-xl">Objective 2 — Canon Adherence</h2>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">The hybrid method for detecting canonical truths proved effective, automatically constructing a “world bible” as the story unfolded. This expands on Ekman &amp; Taylor’s (2016) worldbuilding theory by automating the capture of “hard rules” of the fictional world.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Outcome: The model reliably flagged violations such as species behaving outside defined traits or characters contradicting established lore.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Limitation: Canon facts extracted early sometimes conflicted with later retcons. As with real readers, the system lacked the meta-awareness to recognise that the author had intentionally rewritten prior facts.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Critical Note: Azure content policy occasionally blocked LLM responses containing fictional violence, slowing evaluation. This external factor underscores the dependency of the system on commercial API constraints.</p>
<h2 id="objective-3-continuity-accuracy-3" class="mt-9 scroll-mt-24 font-semibold tracking-tight text-foreground text-xl">Objective 3 — Continuity Accuracy</h2>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">The continuity accuracy metric tracked states of characters, items, and locations, flagging inconsistencies when previously lost or altered elements reappeared unchanged. This directly complements narrative logic by focusing on temporal coherence.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Outcome: The system accurately logged and compared continuity states, surfacing contradictions like “a broken sword being used again.”</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Limitation: Many flagged continuity “errors” were actually deliberate callbacks or flashbacks. This limitation reflects the challenge of distinguishing narrative structure from error—a nuance not addressed in prior work.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Observation: Most identified continuity violations could plausibly serve as future plot developments rather than actual errors. This demonstrates both the sensitivity of the system and the inherent ambiguity in narrative interpretation.</p>
<h2 id="objective-4-worldbuilding-integrity-wis" class="mt-9 scroll-mt-24 font-semibold tracking-tight text-foreground text-xl">Objective 4 — Worldbuilding Integrity (WIS)</h2>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">The worldbuilding integrity system measured semantic drift of core world elements (laws, geography, politics, magic systems). This objective represents the most novel contribution, building on Possible Worlds Theory by computationally modelling world coherence as vector deviation.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Outcome: The system highlighted inconsistencies in world laws (e.g. magic working in void space despite earlier rules) and mapped them to underlying rule violations.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Novel Equation:</p>
<p class="mt-3 text-xs text-muted-foreground italic">Equation 7: WIS</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">This metric is a novel contribution of this research, allowing quantifiable comparison of world integrity between different stories.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Limitation: Lacking baseline expected deviation from human-authored texts, it was challenging to calibrate what counts as “normal drift.”</p>
<h2 id="comparison-to-previous-studies" class="mt-9 scroll-mt-24 font-semibold tracking-tight text-foreground text-xl">Comparison to Previous Studies.</h2>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">The system was built on three theoretical pillars: Narratology, Possible Worlds Theory, and LLM-based cognitive simulation.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Narratology (Alber &amp; Schneider, 2025) framed the narrative as a structured system of analyzable elements (plot events, timelines, arcs). WIE operationalized this by breaking text into discrete claims, storing them as facts, and comparing new events against them.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Possible Worlds Theory (Ekman &amp; Taylor, 2016) views fictional worlds as internally consistent logical systems. WIE applied this perspective to extract and track “Synthetic Truths” (STs), treating them as propositions whose validity should remain stable unless explicitly revised by the author.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">LLM-based cognitive simulation (Zhou et al., 2021; Jenner et al., 2025) provided the capability to emulate the human reader’s reasoning — remembering prior context, detecting contradictions, and judging coherence — at scale.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">WIE thus embodies these theories by encoding narrative logic in vector embeddings, then using GPT models to apply causal reasoning on retrieved context to verify consistency. This bridges narratology’s theory-driven structures with AI’s pattern-recognition ability, supporting the literature’s call for human-AI synergy (Veale &amp; Li, 2016; Boden, 1998).</p>
<h2 id="contributions-and-novelty" class="mt-9 scroll-mt-24 font-semibold tracking-tight text-foreground text-xl">Contributions and Novelty</h2>
<h3 id="key-contributions" class="mt-7 scroll-mt-24 font-semibold tracking-tight text-foreground text-lg">Key Contributions</h3>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">This research advances the field of narrative analysis and computational world-building through several key contributions. These contributions span theoretical formalisation, novel metrics, architectural design, and tool development, collectively representing a new paradigm for assessing narrative integrity in fictional works.</p>
<h4 id="formalisation-of-narrative-integrity-into-four-dimensions" class="mt-6 scroll-mt-24 font-semibold tracking-tight text-foreground text-base">Formalisation of Narrative Integrity into Four Dimensions</h4>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">This study introduces a structured framework for evaluating narrative coherence, disaggregating the concept of “story integrity” into four distinct yet interrelated objectives: Plot Consistency (STLCS), Canon Adherence, Continuity Accuracy (CAM), and Worldbuilding Integrity (WIS). Prior studies have typically conflated these elements under general coherence or factual accuracy checks, whereas this work explicitly operationalises them as separate measurable components. This formalisation clarifies the types of errors that can occur in narratives and allows for targeted detection of each category.</p>
<h4 id="novel-computational-metrics-for-world-integrity-evaluation" class="mt-6 scroll-mt-24 font-semibold tracking-tight text-foreground text-base">Novel Computational Metrics for World Integrity Evaluation</h4>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Building upon the conceptual framework, this work proposes new equations for quantifying narrative consistency.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Analogous formulations were designed for CAM and WIS, each measuring distinct forms of logical failure—continuity errors and semantic drift, respectively. These computational metrics represent an original contribution, as no prior systems have provided quantitative indices of narrative world coherence.</p>
<h4 id="reader-simulation-paradigm-using-llms-and-embeddings" class="mt-6 scroll-mt-24 font-semibold tracking-tight text-foreground text-base">Reader-Simulation Paradigm Using LLMs and Embeddings</h4>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">The system models the cognitive behaviour of a human reader: first extracting key facts, then storing and recalling them, and finally reasoning about new information in light of this knowledge. To achieve this, the engine uses Large Language Models (LLMs) to extract “synthetic truths” (immutable world facts) from text, converts them to embeddings via Azure OpenAI’s text-embedding-ada-002, and stores them in Pinecone for semantic retrieval. This represents a fundamental departure from conventional LLM usage for generative tasks, instead repurposing them for structural logical auditing of fictional worlds.</p>
<h4 id="persistent-world-knowledge-mesh-architecture" class="mt-6 scroll-mt-24 font-semibold tracking-tight text-foreground text-base">Persistent World Knowledge Mesh Architecture</h4>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">A new architectural design was developed for maintaining long-term semantic memories of fictional worlds. This mesh-based knowledge structure stores synthetic truths by category (plot, canon, continuity, world rules) and by story_id, enabling the engine to separate and preserve multiple story worlds concurrently. This design resolves a previously unaddressed issue in narrative evaluation: contamination of facts between unrelated stories.</p>
<h4 id="interactive-evaluation-interface-for-authors" class="mt-6 scroll-mt-24 font-semibold tracking-tight text-foreground text-base">Interactive Evaluation Interface for Authors</h4>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Finally, the system incorporates a React-based frontend that presents detected facts, rules, and violations in an accessible format to non-technical users. This interface transforms abstract logical analyses into actionable feedback, showing authors exactly where contradictions and gaps occur on a chapter-by-chapter basis. By making the tool usable for real-world writing workflows, this contribution bridges the gap between theoretical research and practical application.</p>
<h3 id="further-work" class="mt-7 scroll-mt-24 font-semibold tracking-tight text-foreground text-lg">Further Work</h3>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">The current implementation operates as a standalone evaluator, processing uploaded stories and producing diagnostic reports. Future work will involve evolving this tool into a comprehensive world-building platform. Such a platform would:</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Maintain persistent world meshes, where all synthetic truths discovered about a fictional universe are stored and versioned.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Police contributions to shared worlds, warning authors if their additions violate the foundational rules of the world.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Support preconfigured foundational meshes that could be sold or licensed to authors, allowing them to build within established fictional universes with built-in guardrails.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Enable a marketplace of prebuilt worlds, allowing creators to acquire richly detailed universes and extend them consistently.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Integrate visual world-mapping features to show the structure and strength of a world’s logic as it evolves over time.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Expand the implementation to movie and game scripts.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">With more budget to work with, longer test cases on published works could be performed on better LLM versions.</p>
<h3 id="critical-appraisal" class="mt-7 scroll-mt-24 font-semibold tracking-tight text-foreground text-lg">Critical Appraisal</h3>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">The results support that WIE achieves its objectives, aligning with theoretical expectations from narratology and cognitive science. While not flawless, its capability to detect diverse forms of narrative inconsistency demonstrates a proof of concept that AI can shoulder the cognitive burden of world consistency tracking for authors.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">This represents a step toward the literature’s vision of human-AI creative collaboration (Zhou et al., 2021), with WIE contributing the logical rigor while authors focus on creativity.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">It is important to also note that the World Integrity Engine (WIE) does not evaluate the quality of a story, but the integrity of the world that hosts it. In this framework, the fictional world exists as a foundation — a persistent structure of physical laws, species traits, histories, geographies, and social systems — while the story is merely a temporary sequence of events occurring upon that foundation. The world precedes the story’s genesis and endures beyond its conclusion. By separating the two, the WIE treats the story as an expression of how consistently that foundation is upheld.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">When violations are flagged, they are not necessarily errors in storytelling, but rather signs of structural thinness in the underlying world model. Many such points are in fact creative openings — “vacant lots” in the foundation or “low hanging fruits” — where authors could insert new lore or causal rules to reinforce the world. In this sense, the WIE is not dismantling stories, but highlighting where the foundation could be expanded. This reframes high violation counts not as failures, but as markers of where the world’s logical architecture is least developed and therefore most ripe for creative growth.</p>
<h1 id="chapter-7-conclusion" class="mt-10 scroll-mt-24 font-semibold tracking-tight text-foreground text-2xl">Chapter 7: Conclusion</h1>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">This dissertation set out to design, implement, and evaluate the World Integrity Engine (WIE) — a system that automates the evaluation of logical consistency in fictional narratives. Drawing on structural narratology, Possible Worlds Theory, and LLM-based cognitive simulation, the system assessed stories on four dimensions: Plot Consistency (STLCS), Canon Adherence, Continuity Accuracy (CAM), and Worldbuilding Integrity (WIS).</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Through iterative design and testing, the WIE successfully demonstrated that large language models, when combined with semantic memory (vector embeddings) and structured reasoning workflows, can emulate the reader’s mental process of recalling prior facts, comparing them to new events, and judging their coherence. This validates the theoretical argument that AI can act as a cognitive support tool for authors, relieving them of the intensive memory burden involved in maintaining large fictional worlds.</p>
<h1 id="chapter-8-ethics-approval" class="mt-10 scroll-mt-24 font-semibold tracking-tight text-foreground text-2xl">Chapter 8: ETHICS APPROVAL</h1>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Data Security: All data pertaining to a story are stored securely in a database accessible only through author account login.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Data manipulation: Authors maintain complete control over their stories. The AI only serves to assist in holding it together but never making additions.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">The author of this paper completed a Research and Professional Ethics course. Below is the author’s certificate</p>
<p class="mt-3 text-xs text-muted-foreground italic">Figure 8-1: Research and Professional Ethics Certification of Completion</p>
<h1 id="chapter-9-references" class="mt-10 scroll-mt-24 font-semibold tracking-tight text-foreground text-2xl">Chapter 9: REFERENCES</h1>
<h1 id="appendices" class="mt-10 scroll-mt-24 font-semibold tracking-tight text-foreground text-2xl">Appendices</h1>
<h2 id="evaluatorpy" class="mt-9 scroll-mt-24 font-semibold tracking-tight text-foreground text-xl">Evaluator.py</h2>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">from openai import AzureOpenAI</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">from core.lore_engine import store_fact, search_nearby, setup_logger,clear_vectors</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">from core.openai_api_settings import openai_api_settings as cfg</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">import re</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">import logging</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">import os</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">#  Initialize Azure client once using your config</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">client = AzureOpenAI(</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">api_key=cfg[&quot;api_key&quot;],</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">api_version=cfg[&quot;api_version&quot;],</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">azure_endpoint=cfg[&quot;api_base&quot;]</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">def reset_storage():</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">clear_vectors()</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">print(&quot;Reset Complete&quot;)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">return 0</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground"># OBJECTIVE 1</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">def split_into_chunks(text, max_words=1000):</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">print(&quot;Starting splitting by chapters and chunks.&quot;)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground"># Detect chapters — common pattern: &quot;Chapter 1&quot;, &quot;CHAPTER TWO&quot;, etc.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">chapter_pattern = r&quot;(Chapter\s+\d+|CHAPTER\s+\w+)&quot;</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">parts = re.split(chapter_pattern, text, flags=re.IGNORECASE)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">chunks = []</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">for i in range(1, len(parts), 2):  # Skip even indexes (before first match)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">chapter_title = parts[i].strip()</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">chapter_text = parts[i + 1].strip() if i + 1 &lt; len(parts) else &quot;&quot;</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground"># Break chapter into smaller chunks</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">words = chapter_text.split()</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">for j in range(0, len(words), max_words):</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">chunk_text = &quot; &quot;.join(words[j:j + max_words])</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">chunks.append((chapter_title, chunk_text))</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">return chunks  # Returns list of (chapter, chunk) tuples</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">def extract_critical_claims(chunk):</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">print(&quot;Starting Truth extraction.&quot;)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">system_prompt = &quot;You are a logic assistant. Extract all critical factual claims made by characters or narration that, if contradicted later, would break the story logic.\nRespond in this format:\n- Claim: &lt;factual statement&gt;\n- Source: &lt;quote or scene&gt;\n- Reason: &lt;why it&#x27;s important&gt;&quot;</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">response = client.chat.completions.create(</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">model=cfg[&quot;chat_model&quot;],</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">messages=[</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">{&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: system_prompt},</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">{&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: chunk}</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">],</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">temperature=0</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">return response.choices[0].message.content.split(&quot;\n- Claim: &quot;)[1:]</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">def is_contradiction(claim, new_event):</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">prompt = f&quot;Earlier claim: {claim}\nLater event: {new_event}\nDoes the event contradict the claim without explanation? Why?&quot;</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">response = client.chat.completions.create(</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">model=cfg[&quot;chat_model&quot;],</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">messages=[</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">{&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: &quot;You judge contradictions between story events.&quot;},</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">{&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: prompt}</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">],</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">temperature=0</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">return response.choices[0].message.content if &quot;yes&quot; in response.choices[0].message.content.lower() else None</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground"># OBJECTIVE 2</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">def extract_canon_facts(chunk):</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">&quot;&quot;&quot;</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Extract canonical world facts (synthetic truths) from a story segment using LLM inference.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">These include species traits, magic laws, restrictions, rules, etc.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">&quot;&quot;&quot;</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">prompt = &quot;&quot;&quot;</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">You are an assistant designed to extract canonical world-building facts from a fictional story.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">These are statements that define unchanging rules or limitations in the fictional world.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Extract only the most authoritative and permanent facts (laws of nature, race traits, etc.).</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Return your response in this format:</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">- Canon Fact: &lt;fact&gt;</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Examples:</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">- Canon Fact: Zaratans are blind and rely on echolocation</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">- Canon Fact: Sun mana requires exposure to direct sunlight</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">- Canon Fact: No human can breathe on Mars without a suit</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">- Canon Fact: Only the High Priest can activate the gate</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Now extract canonical facts from this excerpt:</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">&quot;&quot;&quot;</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">try:</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">response = client.chat.completions.create(</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">model=cfg[&quot;chat_model&quot;],</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">messages=[</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">{&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: prompt},</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">{&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: chunk}</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">],</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">temperature=0.2,</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">max_tokens=512,</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">output = response.choices[0].message.content</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">canon_facts = []</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">for line in output.strip().split(&quot;\n&quot;):</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">if line.strip().lower().startswith(&quot;- canon fact:&quot;):</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">canon_facts.append(line.split(&quot;: &quot;, 1)[1].strip())</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">return canon_facts</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">except Exception as e:</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">print(f&quot;[CanonExtractor] Failed on chunk with error: {e}&quot;)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">return []</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">def is_canon_break(canon_fact, story_segment):</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">&quot;&quot;&quot;</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Determines if a new story segment contradicts a known canon fact.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Uses GPT reasoning to make a judgment.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">&quot;&quot;&quot;</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">prompt = f&quot;&quot;&quot;</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Canon Fact: {canon_fact}</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Story Segment: {story_segment}</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Does the story segment contradict the canon fact without explanation?</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Be specific and justify your answer.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">&quot;&quot;&quot;</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">response = client.chat.completions.create(</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">model=cfg[&quot;chat_model&quot;],</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">messages=[</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">{&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: &quot;You are a strict world logic checker. Identify when fictional canon is broken.&quot;},</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">{&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: prompt}</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">],</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">temperature=0</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">content = response.choices[0].message.content.strip()</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">return content if &quot;yes&quot; in content.lower() else None</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground"># OBJECTIVE 3</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">def extract_world_rules(chunk):</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">&quot;&quot;&quot;</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Extract key rules and principles that define the logic, physics, economics,</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">or magic system of a fictional world. These are used to assess internal integrity.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">&quot;&quot;&quot;</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">prompt = &quot;&quot;&quot;</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">You are an assistant that identifies core worldbuilding rules from fictional text.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Extract only stable, general laws that define how the fictional world works.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Return your output in this format:</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">- World Rule: &lt;the rule or law&gt;</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Examples:</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">- World Rule: Gravity magic only works near the crystal spires.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">- World Rule: Currency is measured in ember coins and flint shards.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">- World Rule: The moon reflects light but produces none of its own.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">- World Rule: Wards must be drawn in blood to function.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Now extract worldbuilding rules from this excerpt:</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">&quot;&quot;&quot;</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">try:</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">response = client.chat.completions.create(</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">model=cfg[&quot;chat_model&quot;],</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">messages=[</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">{&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: prompt},</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">{&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: chunk}</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">],</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">temperature=0.3,</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">max_tokens=512,</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">output = response.choices[0].message.content</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">rules = []</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">for line in output.strip().split(&quot;\n&quot;):</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">if line.strip().lower().startswith(&quot;- world rule:&quot;):</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">rules.append(line.split(&quot;: &quot;, 1)[1].strip())</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">print(f&quot;[World Rules:]  {rules}&quot;)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">return rules</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">except Exception as e:</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">print(f&quot;[WorldRuleExtractor] Failed on chunk with error: {e}&quot;)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">return []</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">def is_integrity_break(rule, chunk):</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">&quot;&quot;&quot;</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Determines if a story segment breaks a foundational worldbuilding rule.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">&quot;&quot;&quot;</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">prompt = f&quot;&quot;&quot;</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Worldbuilding Rule: {rule}</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Story Segment: {chunk}</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Does the story segment contradict or violate this worldbuilding rule without clear justification?</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Be precise and explain if so.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">&quot;&quot;&quot;</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">response = client.chat.completions.create(</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">model=cfg[&quot;chat_model&quot;],</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">messages=[</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">{&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: &quot;You are an expert in fictional world logic. Find when rules are broken.&quot;},</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">{&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: prompt}</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">],</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">temperature=0</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">content = response.choices[0].message.content.strip()</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">return content if &quot;yes&quot; in content.lower() else None</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">def extract_continuity_facts(chunk):</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">&quot;&quot;&quot;</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Extract continuity-relevant facts (timelines, object states, character attributes).</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">&quot;&quot;&quot;</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">prompt = &quot;&quot;&quot;</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">You are a continuity assistant for fictional stories. Your job is to extract key facts about events, characters, objects, and states that need to remain consistent throughout the story.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Extract facts like:</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">- Injuries, deaths, lost items</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">- Time-sensitive events or countdowns</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">- States of objects (damaged, missing, used)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">- Character traits, knowledge, or decisions</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Return results in this format:</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">- Continuity Fact: &lt;description&gt;</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Now extract continuity facts from the following excerpt:</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">&quot;&quot;&quot;</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">try:</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">response = client.chat.completions.create(</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">model=cfg[&quot;chat_model&quot;],</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">messages=[</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">{&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: prompt},</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">{&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: chunk}</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">],</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">temperature=0,</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">max_tokens=512,</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">output = response.choices[0].message.content</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">facts = []</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">for line in output.strip().split(&quot;\n&quot;):</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">if line.strip().lower().startswith(&quot;- continuity fact:&quot;):</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">facts.append(line.split(&quot;: &quot;, 1)[1].strip())</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">return facts</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">except Exception as e:</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">print(f&quot;[ContinuityExtractor] Failed on chunk with error: {e}&quot;)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">return []</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">def is_continuity_break(past_fact, new_segment):</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">&quot;&quot;&quot;</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Determines if a new story segment contradicts a known continuity fact.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">&quot;&quot;&quot;</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">prompt = f&quot;&quot;&quot;</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Continuity Fact: {past_fact}</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Story Segment: {new_segment}</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Does the story segment contradict this continuity fact without justification?</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Be precise and explain your reasoning.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">&quot;&quot;&quot;</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">response = client.chat.completions.create(</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">model=cfg[&quot;chat_model&quot;],</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">messages=[</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">{&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: &quot;You are a continuity supervisor. Identify contradictions in timeline, character, or state.&quot;},</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">{&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: prompt}</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">],</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">temperature=0</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">content = response.choices[0].message.content.strip()</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">return content if &quot;yes&quot; in content.lower() else None</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground"># CORE FUNCTIONS</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">def evaluate_plot_consistency(text, story_id=&quot;default&quot;):</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">plot_consistency_logger = setup_logger(&quot;plot_consistency&quot;, str(story_id))</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">print(&quot;Starting Evaluation of plot consistency.&quot;)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">plot_consistency_logger.info(f&quot;Starting Evaluation of plot consistency...&quot;)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">chunks = split_into_chunks(text)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">all_claims = []</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">violations = []</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">for i, (chapter_title, chunk) in enumerate(chunks):</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">claims = extract_critical_claims(chunk)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">for c in claims:</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">store_fact(&quot;plot&quot;, c, chapter=chapter_title, story_id=story_id)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">all_claims.append((i, c))</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">print(all_claims)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">plot_consistency_logger.info(f&quot;[ All Claims ]: {all_claims}&quot;)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">for i, chunk in enumerate(chunks):</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">for j, (ci, claim) in enumerate(all_claims):</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">if ci &lt; i:</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">results = search_nearby(&quot;plot&quot;, claim, story_id=story_id)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">for match in results:</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">contradiction = is_contradiction(claim, chunk)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">if contradiction:</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">violations.append({</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">&quot;claim&quot;: claim,</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">&quot;conflict&quot;: chunk[:300],</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">&quot;reason&quot;: contradiction</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">})</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">total = len(all_claims)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">score = 100 - ((len(violations) / total) * 100) if total &gt; 0 else 100</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">plot_consistency_logger.info(f&quot;[ Score ] : {score}&quot;)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">plot_consistency_logger.info(f&quot;[ Violations ] : {violations}&quot;)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">return {</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">&quot;score&quot;: round(score),</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">&quot;violations&quot;: violations,</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">&quot;all_claims&quot;: all_claims</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">}</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground"># Placeholder scores for other objectives (to be implemented)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">def evaluate_continuity_accuracy(text):</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">continuity_logger = setup_logger(&quot;continuity&quot;, text[:10])</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">print(&quot;Starting Evaluation of continuity accuracy.&quot;)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">continuity_logger.info(f&quot;[Starting Evaluation of continuity accuracy.] :&quot;)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">chunks = split_into_chunks(text)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground"># Step 1: Extract and store continuity facts</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">for i, (chapter_title, chunk) in enumerate(chunks):</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">continuity_facts = extract_continuity_facts(chunk)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">for fact in continuity_facts:</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">store_fact(&quot;continuity&quot;, fact, chapter=chapter_title, story_id=&quot;default&quot;)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground"># Step 2: Search relevant continuity facts</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">all_facts = search_nearby(category=&quot;continuity&quot;, text=&quot;continuity&quot;, top_k=50)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">continuity_logger.info(f&quot;[Continuity Facts: ] {all_facts}&quot;)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">print(f&quot;[All Continuity Facts: ] {all_facts}&quot;)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">total_extracted_facts = [match[&quot;metadata&quot;][&quot;text&quot;] for match in all_facts]</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground"># Step 3: Check for continuity breaks</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">violations = []</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">for chunk in chunks:</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">for match in all_facts:</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">continuity_text = match[&quot;metadata&quot;][&quot;text&quot;]</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">contradiction = is_continuity_break(continuity_text, chunk)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">if contradiction:</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">violations.append({</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">&quot;claim&quot;: continuity_text,</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">&quot;conflict&quot;: chunk[:300],</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">&quot;reason&quot;: contradiction</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">})</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">score = 100 - ((len(violations) / len(all_facts)) * 100) if all_facts else 100</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">continuity_logger.info(f&quot;[ Score ] : {score}&quot;)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">continuity_logger.info(f&quot;[ Violations ] : {violations}&quot;)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">return {&quot;score&quot;: round(score), &quot;violations&quot;: violations, &quot;total_extracted_facts&quot;:total_extracted_facts}</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">def evaluate_canon_adherence(text, story_id=&quot;default&quot;):</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">canon_logger = setup_logger(&quot;canon_adherence&quot;, str(story_id))</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">print(&quot;Starting Evaluation of canon adherence.&quot;)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">print(f&quot;[STORY ID] Using story_id: {story_id}&quot;)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">canon_logger.info(&quot;Starting Evaluation of canon adherence.&quot;)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">canon_logger.info(f&quot;[STORY ID] Using story_id: {story_id}&quot;)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">chunks = split_into_chunks(text)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">#  Step 1: Extract and store canon facts from current story</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">for i, (chapter_title, chunk) in enumerate(chunks):</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">canon_facts = extract_canon_facts(chunk)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">print(canon_facts)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">canon_logger.info(f&quot;[Chapter: {chapter_title}] Extracted canon facts: {canon_facts}&quot;)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">for fact in canon_facts:</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">store_fact(&quot;canon&quot;, fact, chapter=chapter_title, story_id=story_id)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">#  Step 2: Search stored canon facts</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">canon_vectors = search_nearby(category=&quot;canon&quot;, text=&quot;canon&quot;, top_k=50, story_id=story_id)# or get_all_canon_facts()</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">print(canon_vectors)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">canon_logger.info(f&quot;Retrieved {len(canon_vectors)} canon vectors for comparison.&quot;)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground"># Step 3: Check each chunk against canon</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">violations = []</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">for chunk in chunks:</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">for match in canon_vectors:</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">canon_text = match[&quot;metadata&quot;][&quot;text&quot;]</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">print(&quot;This is the texts being checked: &quot;,canon_text)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">canon_logger.debug(f&quot;Checking canon text: {canon_text[:80]}... against chunk {chapter_title}&quot;)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">contradiction = is_canon_break(canon_text, chunk)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">if contradiction:</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">violations.append({</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">&quot;claim&quot;: canon_text,</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">&quot;conflict&quot;: chunk[:300],</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">&quot;reason&quot;: contradiction</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">})</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">canon_logger.warning(f&quot;Violation found in {chapter_title}: {violations}&quot;)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">score = 100 - ((len(violations) / len(canon_vectors)) * 100) if canon_vectors else 100</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">canon_logger.info(f&quot;[ Score ] : {score}&quot;)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">canon_logger.info(f&quot;[ Violations ] : {violations}&quot;)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">return {&quot;score&quot;: round(score), &quot;violations&quot;: violations, &quot;canon_facts&quot;: canon_facts}</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">def evaluate_worldbuilding_integrity(text):</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">wbi_logger = setup_logger(&quot;world_building_integrity&quot;, text[:10])</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">print(&quot;Starting Evaluation of worldbuilding integrity.&quot;)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">wbi_logger.info(f&quot;Starting Evaluation of worldbuilding integrity...&quot;)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">chunks = split_into_chunks(text)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">#  Step 1: Extract and store world rules</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">for i, (chapter_title, chunk) in enumerate(chunks):</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">rules = extract_world_rules(chunk)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">print(f&quot;[WorldRules] {chapter_title}: {rules}&quot;)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">wbi_logger.info(f&quot;[WorldRules] {chapter_title}: {rules}&quot;)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">for rule in rules:</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">store_fact(&quot;integrity&quot;, rule, chapter=chapter_title, story_id=&quot;default&quot;)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground"># Step 2: Retrieve all known rules</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">integrity_vectors = search_nearby(category=&quot;integrity&quot;, text=&quot;rule&quot;, top_k=50)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground"># Step 3: Evaluate each chunk against stored world rules</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">violations = []</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">for chunk in chunks:</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">for match in integrity_vectors:</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">rule = match[&quot;metadata&quot;][&quot;text&quot;]</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">contradiction = is_integrity_break(rule, chunk)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">if contradiction:</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">violations.append({</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">&quot;rule&quot;: rule,</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">&quot;conflict&quot;: chunk[:300],</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">&quot;reason&quot;: contradiction</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">})</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">score = 100 - ((len(violations) / len(integrity_vectors)) * 100) if integrity_vectors else 100</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">wbi_logger.info(f&quot;[ Score ] : {score}&quot;)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">wbi_logger.info(f&quot;[ Violations ] : { violations }&quot;)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">return {</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">&quot;wis&quot;: round(score),</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">&quot;violations&quot;: violations,</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">&quot;rules&quot;: rules</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">}</p>
<h2 id="loreenginepy" class="mt-9 scroll-mt-24 font-semibold tracking-tight text-foreground text-xl">Lore_engine.py</h2>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">from pinecone import Pinecone, ServerlessSpec</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">from openai import AzureOpenAI</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">from core.openai_api_settings import openai_api_settings as cfg</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">import logging</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">import os</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground"># Initialize Azure OpenAI client</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">client = AzureOpenAI(</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">api_key=cfg[&quot;api_key&quot;],</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">api_version=cfg[&quot;api_version&quot;],</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">azure_endpoint=cfg[&quot;api_base&quot;]</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">def embed_text(text):</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">response = client.embeddings.create(</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">model=cfg[&quot;embedding_model&quot;],</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">input=[text]</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">return response.data[0].embedding</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">#  Pinecone setup</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">pc = Pinecone(api_key=&quot;XXX&quot;)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground"># Create index if it doesn&#x27;t exist</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">if &quot;wie-index&quot; not in pc.list_indexes().names():</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">pc.create_index(</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">name=&quot;wie-index&quot;,</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">dimension=1536,</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">metric=&quot;cosine&quot;,</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">spec=ServerlessSpec(cloud=&quot;aws&quot;, region=&quot;us-east-1&quot;)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground"># Get Pinecone index</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">index = pc.Index(&quot;wie-index&quot;)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">#  Store a fact in Pinecone</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">def store_fact(category, text, chapter, story_id=&quot;default&quot;):</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">vector = embed_text(text)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">metadata = {</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">&quot;category&quot;: category,</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">&quot;chapter&quot;: chapter,</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">&quot;text&quot;: text,</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">&quot;story_id&quot;: story_id</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">}</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">index.upsert([(f&quot;{story_id}-{category}-{chapter}-{hash(text)}&quot;, vector, metadata)])</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">def clear_vectors():</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">try:</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground"># Defensive: check index still exists</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">if &quot;wie-index&quot; not in pc.list_indexes().names():</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground"># Recreate fresh index</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">pc.create_index(</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">name=&quot;wie-index&quot;,</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">dimension=1536,</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">metric=&quot;cosine&quot;,</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">spec=ServerlessSpec(cloud=&quot;aws&quot;, region=&quot;us-east-1&quot;)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">else:</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground"># If it exists, just clear vectors</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">index.delete(delete_all=True)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">except Exception as e:</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">print(f&quot;Error clearing vectors: {e}&quot;)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">raise</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground"># Search nearby facts in Pinecone</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">def search_nearby(category, text=None, vector=None, top_k=3, story_id=&quot;default&quot;):</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">&quot;&quot;&quot;</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Search for similar stored facts in Pinecone.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">If a vector is provided, use it directly; otherwise embed from text.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">&quot;&quot;&quot;</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">if vector is None:</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">if text is None:</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">raise ValueError(&quot;Either `text` or `vector` must be provided.&quot;)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">vector = embed_text(text)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">results = index.query(vector=vector, top_k=top_k, include_metadata=True)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">return [</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">r for r in results[&#x27;matches&#x27;]</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">if r[&#x27;metadata&#x27;].get(&#x27;category&#x27;) == category and r[&#x27;metadata&#x27;].get(&#x27;story_id&#x27;) == story_id</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">]</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">def setup_logger(name, book_title, log_dir=&quot;logs&quot;):</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">&quot;&quot;&quot;</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Create and return a logger that writes to a file named after the book.</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">Example: logs/&lt;book_title&gt;_&lt;name&gt;.log</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">&quot;&quot;&quot;</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground"># Ensure logs directory exists</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">os.makedirs(log_dir, exist_ok=True)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground"># Clean up book title (no spaces/special chars in filenames)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">safe_title = &quot;&quot;.join(c if c.isalnum() or c in (&quot;_&quot;, &quot;-&quot;) else &quot;_&quot; for c in book_title)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">log_filename = os.path.join(log_dir, f&quot;{safe_title}_{name}.log&quot;)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">logger = logging.getLogger(f&quot;{name}_{safe_title}&quot;)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">logger.setLevel(logging.INFO)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground"># Avoid adding multiple handlers if already exists</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">if not logger.handlers:</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">fh = logging.FileHandler(log_filename, encoding=&quot;utf-8&quot;)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">formatter = logging.Formatter(&quot;%(asctime)s - %(levelname)s - %(message)s&quot;)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">fh.setFormatter(formatter)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">logger.addHandler(fh)</p>
<p class="mt-3 text-sm leading-relaxed text-muted-foreground">return logger</p>
      </article>

      <footer class="mt-6 pb-10 text-xs text-muted-foreground">
        <p>Generated from: <span class="font-medium text-foreground">SID_2355846 Final Version-1.docx</span></p>
      </footer>
    </main>
  </div>

  <script>
    // theme toggle (persisted)
    const root = document.documentElement;
    const saved = localStorage.getItem("theme");
    if (saved === "dark") root.classList.add("dark");

    document.getElementById("themeBtn")?.addEventListener("click", () => {
      root.classList.toggle("dark");
      localStorage.setItem("theme", root.classList.contains("dark") ? "dark" : "light");
    });
  </script>
</body>
</html>
